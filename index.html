<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ä¼˜é›…Â·ç®€çº¦ä¸ªäººç«™</title>
    <meta name="description" content="ä¸€ä¸ªä¼˜é›…ã€ç®€çº¦çš„ä¸ªäººç«™ç‚¹ï¼Œé›†æˆå¯¼èˆªå’Œåšå®¢åŠŸèƒ½ã€‚æ”¯æŒæœç´¢ã€æ ‡ç­¾ç­›é€‰ã€æš—è‰²/äº®è‰²ä¸»é¢˜ã€å¯¼å…¥å¯¼å‡º JSONã€RSSã€‚" />
    <link rel="icon" href="./assets/favicon.png" type="image/png">
    <style>
        /* ===== è®¾è®¡ç³»ç»Ÿï¼ˆCSS å˜é‡ï¼‰ ===== */
        :root {
            --bg: #f7f7f8;
            --surface: #ffffff;
            --surface-2: #f4f4f6;
            --text: #0c0c0d;
            --muted: #6a6a6d;
            --border: #e6e6e9;
            --accent: #4c83ff;
            /* ä¸»è‰²ï¼Œå¯åˆ‡æ¢ */
            --ring: color-mix(in oklab, var(--accent) 35%, white);
            --radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, .06);
            --focus: 0 0 0 3px color-mix(in oklab, var(--accent) 20%, transparent);
            --container: min(1120px, 94vw);
            --sidebar: 280px;
            --gap: clamp(14px, 2vw, 18px);
            --code-bg: #0d0f14;
            --code-text: #eaeaf0;
        }

        [data-theme="dark"] {
            --bg: #0c0d10;
            --surface: #111318;
            --surface-2: #0e1014;
            --text: #e9e9ee;
            --muted: #9a9aa3;
            --border: #1f2229;
            --accent: #6aa1ff;
            --ring: color-mix(in oklab, var(--accent) 20%, black);
            --shadow: 0 10px 30px rgba(0, 0, 0, .35);
            --code-bg: #0a0c10;
            --code-text: #e9e9f2;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            font: 15px/1.72 ui-sans-serif, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, "Noto Sans CJK SC";
            color: var(--text);
            background:
                radial-gradient(1200px 800px at 80% -10%, color-mix(in oklab, var(--accent) 12%, transparent), transparent) no-repeat,
                radial-gradient(1000px 700px at -10% 10%, color-mix(in oklab, var(--accent) 10%, transparent), transparent) no-repeat,
                var(--bg);
            letter-spacing: .2px;
        }

        /* æ–‡å­—é€‰æ‹©é¢œè‰² */
        ::selection {
            background: color-mix(in oklab, var(--accent) 25%, transparent);
            color: var(--text);
        }

        ::-moz-selection {
            background: color-mix(in oklab, var(--accent) 25%, transparent);
            color: var(--text);
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        a.link {
            color: color-mix(in oklab, var(--accent) 90%, white);
        }

        .wrap {
            width: var(--container);
            margin: 28px auto 80px;
        }

        /* ===== é¡¶æ  ===== */
        header.topbar {
            position: sticky;
            top: 0;
            z-index: 5;
            backdrop-filter: saturate(1.2) blur(10px);
            background: color-mix(in oklab, var(--bg) 70%, transparent);
            border-bottom: 1px solid var(--border);
        }

        .topbar-inner {
            width: var(--container);
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 12px 0;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            width: 26px;
            height: 26px;
            border-radius: 8px;
            background: url('./assets/favicon.png') center/cover;
            box-shadow: inset 0 -10px 18px rgba(0, 0, 0, .12);
        }

        .brand-title {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: .3px;
        }

        .muted {
            color: var(--muted);
        }

        .actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn,
        .chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            height: 36px;
            padding: 0 12px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            border-radius: 999px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 16px 40px rgba(0, 0, 0, .08);
        }

        .btn:focus-visible {
            outline: none;
            box-shadow: var(--focus);
        }

        .btn.ghost {
            background: transparent;
            box-shadow: none;
        }

        .btn.primary {
            background: color-mix(in oklab, var(--accent) 96%, #fff);
            color: white;
            border-color: color-mix(in oklab, var(--accent) 88%, #fff);
        }

        /* ===== å¯¼èˆªæ ‡ç­¾ ===== */
        .nav-tabs {
            display: inline-flex;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 4px;
            gap: 6px;
            box-shadow: var(--shadow);
        }

        .nav-tabs button {
            border: none;
            background: transparent;
            padding: 6px 12px;
            border-radius: 999px;
            cursor: pointer;
            color: var(--muted);
        }

        .nav-tabs button[aria-pressed="true"] {
            background: color-mix(in oklab, var(--accent) 10%, transparent);
            color: var(--text);
        }

        /* ===== å¸ƒå±€ ===== */
        .layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--gap);
        }

        @media (min-width: 980px) {
            .layout {
                grid-template-columns: 1fr var(--sidebar);
            }
        }

        /* æœç´¢æ¡† */
        .search {
            position: relative;
            margin: 18px 0 10px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: center;
        }

        .search input {
            height: 48px;
            width: 100%;
            padding: 0 44px 0 44px;
            border-radius: 14px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            box-shadow: var(--shadow);
        }

        .search .iconL,
        .search .iconR {
            position: absolute;
            width: 20px;
            height: 20px;
            opacity: .7;
        }

        .search .iconL {
            left: 14px;
        }

        .search .iconR {
            right: 14px;
        }

        .search .clear-btn {
            position: absolute;
            right: 50px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            border: none;
            background: color-mix(in oklab, var(--muted) 20%, transparent);
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            color: var(--muted);
            transition: all .2s ease;
        }

        .search .clear-btn:hover {
            background: color-mix(in oklab, var(--muted) 30%, transparent);
            color: var(--text);
        }

        .search .clear-btn.show {
            display: flex;
        }

        .kbd {
            font: 12px/1.2 ui-sans-serif;
            padding: 3px 6px;
            border: 1px solid var(--border);
            border-bottom-width: 2px;
            border-radius: 6px;
            background: var(--surface);
            color: var(--muted);
        }

        /* æ ‡ç­¾æ¡ */
        .tagbar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 8px 0 18px;
        }

        .chip {
            height: 34px;
            padding: 0 12px;
        }

        .chip[data-active="true"] {
            border-color: color-mix(in oklab, var(--accent) 60%, #fff);
            box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 18%, transparent);
        }

        /* è§†å›¾åˆ‡æ¢ */
        .viewtabs {
            display: inline-flex;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 4px;
            gap: 6px;
            box-shadow: var(--shadow);
        }

        .viewtabs button {
            border: none;
            background: transparent;
            padding: 6px 12px;
            border-radius: 999px;
            cursor: pointer;
            color: var(--muted);
        }

        .viewtabs button[aria-pressed="true"] {
            background: color-mix(in oklab, var(--accent) 10%, transparent);
            color: var(--text);
        }

        /* ç½‘æ ¼å¡ç‰‡ */
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--gap);
        }

        @media (min-width: 720px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1200px) {
            .grid.nav-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .card {
            position: relative;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            display: grid;
            gap: 10px;
            box-shadow: var(--shadow);
            transition: transform .16s ease, box-shadow .2s ease, border-color .2s ease, background .2s ease;
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 44px rgba(0, 0, 0, .12);
            border-color: color-mix(in oklab, var(--accent) 20%, var(--border));
        }

        .card:focus-visible {
            outline: none;
            box-shadow: var(--focus);
        }

        /* å¯¼èˆªå¡ç‰‡æ ·å¼ */
        .nav-card {
            padding: 14px;
        }

        .nav-card .row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .favicon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            box-shadow: inset 0 0 0 1px var(--border);
        }

        .favicon.error {
            background: var(--surface-2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--muted);
        }

        .favicon.error::after {
            content: "ğŸŒ";
        }

        .nav-card h3 {
            font-size: 14px;
            margin: 0;
            line-height: 1.4;
            letter-spacing: .2px;
        }

        .nav-card .desc {
            font-size: 12px;
            color: var(--muted);
            min-height: 32px;
        }

        .open {
            position: absolute;
            right: 10px;
            top: 10px;
            width: 28px;
            height: 28px;
            border-radius: 999px;
            display: grid;
            place-items: center;
            border: 1px solid var(--border);
            background: var(--surface);
            opacity: 0;
            transition: opacity .2s ease;
        }

        .card:hover .open {
            opacity: 1;
        }

        .open:hover {
            border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
        }

        /* ===== Editorial Rail åšå®¢å¡ç‰‡æ ·å¼ ===== */

        /* åŸºç¡€å¡ç‰‡ */
        .post {
            position: relative;
            overflow: hidden;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 18px;
            box-shadow: var(--shadow);
            transition: transform .25s ease, box-shadow .25s ease;
            cursor: pointer;
        }

        .post:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, .12);
        }

        /* Editorial Railï¼šå·¦ä¾§æ—¥æœŸå¯¼è½¨ */
        .post--rail {
            display: grid;
            grid-template-columns: 76px 1fr;
        }

        .post--rail::before {
            content: "";
            position: absolute;
            left: 75px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--border);
        }

        .rail {
            position: relative;
            padding: 18px 0;
            display: grid;
            place-items: center;
        }

        .rail .day {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, color-mix(in oklab, var(--accent), transparent 70%), transparent 40%),
                linear-gradient(180deg, color-mix(in oklab, var(--surface), #000 4%), var(--surface));
            border: 1px solid var(--border);
            display: grid;
            place-items: center;
            font-weight: 900;
            font-variant-numeric: tabular-nums;
            color: var(--text);
        }

        .rail .month {
            position: absolute;
            bottom: 10px;
            font-size: 0.78rem;
            color: var(--muted);
        }

        .rail .pin {
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 999px;
            background: color-mix(in oklab, var(--accent), transparent 86%);
            color: color-mix(in oklab, var(--accent), #000 20%);
            border: 1px solid color-mix(in oklab, var(--accent), transparent 70%);
            white-space: nowrap;
        }

        /* Featuredï¼šè·¨ä¸¤åˆ—å¸¦å°é¢çš„å¤§å¡ */
        .post--featured {
            grid-column: 1/-1;
            display: grid;
            grid-template-columns: 1.2fr 1fr;
        }

        .cover {
            position: relative;
            overflow: hidden;
            border-right: 1px solid var(--border);
            background: var(--surface-2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cover-placeholder {
            color: var(--muted);
            font-size: 14px;
            padding: 20px;
        }

        .cover .cap {
            position: absolute;
            left: 14px;
            bottom: 14px;
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            background: color-mix(in oklab, var(--accent), transparent 80%);
            color: #fff;
            padding: 6px 10px;
            border-radius: 10px;
            font-size: 0.78rem;
        }

        /* å†…å®¹åŒº */
        .content {
            padding: 18px 18px 14px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* æ™®é€šæ–‡ç« çš„å†…å®¹åŒºæ›´ç´§å‡‘ */
        .post--rail .content {
            padding: 20px 12px 8px;
            gap: 6px;
        }

        .title {
            margin: 0;
            font-weight: 800;
            font-size: clamp(18px, 2.2vw, 22px);
            line-height: 1.35;
            min-height: 2.7em;
            /* ç¡®ä¿è‡³å°‘æœ‰ä¸¤è¡Œçš„é«˜åº¦ */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* æ™®é€šæ–‡ç« çš„æ ‡é¢˜æ›´å° */
        .post--rail .title {
            font-size: clamp(15px, 1.8vw, 17px);
            font-weight: 700;
            min-height: 2.2em;
            /* å¯¹åº”è¾ƒå°å­—ä½“çš„ä¸¤è¡Œé«˜åº¦ */
            line-height: 1.3;
        }

        .title a {
            color: var(--text);
            text-decoration: none;
            border-bottom: 2px solid transparent;
            transition: color .2s ease, border-color .2s ease;
        }

        .title a:hover {
            color: var(--accent);
            border-color: color-mix(in oklab, var(--accent), transparent 55%);
        }

        .meta {
            font-size: 0.88rem;
            color: var(--muted);
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* æ™®é€šæ–‡ç« çš„metaä¿¡æ¯æ›´å° */
        .post--rail .meta {
            font-size: 0.75rem;
            gap: 6px;
            margin: 2px 0;
        }

        .excerpt {
            color: color-mix(in oklab, var(--text), #000 10%);
            font-size: 0.98rem;
            margin-top: 2px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag {
            font-size: 0.78rem;
            padding: 5px 10px;
            border-radius: 999px;
            text-decoration: none;
            color: var(--muted);
            background: color-mix(in oklab, var(--muted), transparent 92%);
            border: 1px solid color-mix(in oklab, var(--muted), transparent 85%);
            transition: all .2s ease;
        }

        /* æ™®é€šæ–‡ç« çš„æ ‡ç­¾æ›´å° */
        .post--rail .tag {
            font-size: 0.7rem;
            padding: 3px 8px;
        }

        .tag:hover {
            color: var(--accent);
            background: color-mix(in oklab, var(--accent), transparent 90%);
            border-color: color-mix(in oklab, var(--accent), transparent 75%);
        }

        .foot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 8px;
        }

        /* ç‰¹è‰²æ–‡ç« çš„footåªæœ‰æŒ‰é’®ï¼Œå·¦å¯¹é½ */
        .post--featured .foot {
            justify-content: flex-start;
        }

        .read-time {
            font-size: 0.7rem;
            color: var(--muted);
            font-weight: 500;
        }

        /* åˆ†é¡µæ ·å¼ */
        .pagination-wrapper {
            width: 100%;
            text-align: center;
        }

        .pagination {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 24px 0 12px 0;
            flex-wrap: wrap;
        }

        .pagination-btn {
            min-width: 40px;
            height: 40px;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: 600;
        }

        .pagination-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .pagination-btn.active:hover {
            background: var(--accent);
            color: white;
            transform: none;
        }

        .pagination-ellipsis {
            padding: 8px 4px;
            color: var(--muted);
            font-size: 14px;
        }

        .pagination-info {
            text-align: center;
            font-size: 13px;
            color: var(--muted);
            margin-top: 8px;
        }

        @media (max-width: 480px) {
            .pagination {
                gap: 4px;
            }

            .pagination-btn {
                min-width: 36px;
                height: 36px;
                padding: 6px 10px;
                font-size: 13px;
            }
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 9px 14px;
            border-radius: 999px;
            font-weight: 650;
            font-size: 0.92rem;
            text-decoration: none;
            color: var(--text);
            border: 1px solid var(--border);
            background: linear-gradient(180deg, color-mix(in oklab, var(--surface), #000 3%), var(--surface));
            transition: transform .2s ease, border-color .2s ease;
        }

        /* æ™®é€šæ–‡ç« çš„æŒ‰é’®æ›´å° */
        .post--rail .btn {
            padding: 6px 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-1px);
            border-color: color-mix(in oklab, var(--border), #000 30%);
            color: var(--accent);
        }

        /* å¯ç‚¹å‡»æ•´å¡ */
        .stretched {
            position: absolute;
            inset: 0;
            z-index: 1;
            border-radius: inherit;
        }

        .tags a,
        .btn {
            position: relative;
            z-index: 2;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 860px) {
            .post--featured {
                grid-template-columns: 1fr;
            }

            .cover {
                border-right: none;
                border-bottom: 1px solid var(--border);
                min-height: 120px;
            }
        }

        @media (max-width: 768px) {
            .post--rail {
                grid-template-columns: 60px 1fr;
            }

            .post--rail::before {
                left: 59px;
            }

            .rail .day {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }

            .rail .month {
                font-size: 0.7rem;
            }

            .content {
                padding: 14px 14px 12px;
            }

            .title {
                font-size: clamp(16px, 2vw, 18px);
            }
        }

        @media (max-width: 480px) {
            .post--rail {
                grid-template-columns: 50px 1fr;
            }

            .post--rail::before {
                left: 49px;
            }

            .rail {
                padding: 12px 0;
            }

            .rail .day {
                width: 32px;
                height: 32px;
                font-size: 12px;
            }

            .content {
                padding: 12px;
                gap: 6px;
            }

            .meta {
                font-size: 0.8rem;
                gap: 8px;
            }

            .excerpt {
                font-size: 0.9rem;
            }

            .tags {
                gap: 6px;
            }

            .tag {
                font-size: 0.7rem;
                padding: 3px 8px;
            }

            .btn {
                padding: 7px 12px;
                font-size: 0.85rem;
            }
        }

        /* æ—§æ ·å¼ä¿æŒå…¼å®¹ */
        .post-title {
            font-size: 18px;
            margin: 0 0 6px 0;
            letter-spacing: .2px;
            line-height: 1.4;
            font-weight: 500;
        }

        .meta {
            font-size: 12px;
            color: var(--muted);
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
        }

        .tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin: 12px 0 8px 0;
        }

        .t {
            font-size: 11px;
            color: var(--muted);
            padding: 4px 6px;
            border-radius: 6px;
            border: 1px solid var(--border);
            transition: all .2s ease;
            text-decoration: none;
        }

        .t:hover {
            border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
            background: color-mix(in oklab, var(--accent) 5%, transparent);
        }

        /* åšå®¢å¡ç‰‡å†…çš„æ ‡ç­¾æŒ‰é’®æ ·å¼ */
        .t.tag-filter {
            background: transparent;
            cursor: pointer;
        }

        .t.tag-filter:hover {
            border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
            background: color-mix(in oklab, var(--accent) 8%, transparent);
            color: var(--accent);
        }

        .t.tag-filter.active {
            border-color: var(--accent);
            background: color-mix(in oklab, var(--accent) 15%, transparent);
            color: var(--accent);
        }

        /* ä¾§è¾¹æ æ ‡ç­¾äº‘æŒ‰é’®æ ·å¼ */
        .t.sidebar-tag-filter {
            background: transparent;
            cursor: pointer;
            margin: 2px;
        }

        .t.sidebar-tag-filter:hover {
            border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
            background: color-mix(in oklab, var(--accent) 8%, transparent);
            color: var(--accent);
        }

        .t.sidebar-tag-filter.active {
            border-color: var(--accent);
            background: color-mix(in oklab, var(--accent) 15%, transparent);
            color: var(--accent);
        }

        /* æ ‡ç­¾å±•å¼€æŒ‰é’®æ ·å¼ - ç¾åŒ–ç‰ˆ */
        .t.expand-tags {
            background: var(--surface);
            color: var(--muted);
            cursor: pointer;
            font-weight: 500;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all .2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, .05);
        }

        .t.expand-tags:hover {
            background: var(--surface-2);
            border-color: var(--border);
            color: var(--text);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, .08);
        }

        .t.expand-tags::before {
            content: "âŒ„";
            font-size: 14px;
            transition: transform .2s ease;
        }

        /* æ ‡ç­¾æ”¶èµ·æŒ‰é’®æ ·å¼ - ç¾åŒ–ç‰ˆ */
        .t.collapse-tags {
            background: var(--surface);
            color: var(--muted);
            cursor: pointer;
            font-weight: 500;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all .2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, .05);
        }

        .t.collapse-tags:hover {
            background: var(--surface-2);
            border-color: var(--border);
            color: var(--text);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, .08);
        }

        .t.collapse-tags::before {
            content: "âŒƒ";
            font-size: 14px;
            transition: transform .2s ease;
        }

        /* ä¾§è¾¹æ å±•å¼€æŒ‰é’®æ ·å¼ - ç¾åŒ–ç‰ˆ */
        .t.expand-sidebar-tags {
            background: var(--surface);
            color: var(--muted);
            cursor: pointer;
            font-weight: 500;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all .2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, .05);
            margin-left: 8px;
        }

        .t.expand-sidebar-tags:hover {
            background: var(--surface-2);
            border-color: var(--border);
            color: var(--text);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, .08);
        }

        .t.expand-sidebar-tags::before {
            content: "âŒ„";
            font-size: 14px;
            transition: transform .2s ease;
        }

        /* ä¾§è¾¹æ æ”¶èµ·æŒ‰é’®æ ·å¼ - ç¾åŒ–ç‰ˆ */
        .t.collapse-sidebar-tags {
            background: var(--surface);
            color: var(--muted);
            cursor: pointer;
            font-weight: 500;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: all .2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, .05);
            margin-left: 8px;
        }

        .t.collapse-sidebar-tags:hover {
            background: var(--surface-2);
            border-color: var(--border);
            color: var(--text);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, .08);
        }

        .t.collapse-sidebar-tags::before {
            content: "âŒƒ";
            font-size: 14px;
            transition: transform .2s ease;
        }

        /* ===== å½’æ¡£é¡µé¢æ ·å¼ - Ledger é£æ ¼ ===== */
        .archive-header {
            margin-bottom: 32px;
            text-align: center;
        }

        .archive-title h2 {
            margin: 0 0 8px 0;
            font-size: clamp(22px, 2.6vw, 30px);
            font-weight: 600;
        }

        .archive-summary {
            color: var(--muted);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .archive-timeline {
            max-width: 900px;
            margin: 0 auto;
        }

        /* å¹´ä»½æ ‡é¢˜æ  - ç²˜æ€§å®šä½ */
        .archive-year {
            margin-bottom: 32px;
        }

        .archive-year-header {
            position: sticky;
            top: 10px;
            z-index: 1;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 12px 16px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .archive-year-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent);
            box-shadow: 0 0 0 4px color-mix(in oklab, var(--accent), transparent 85%);
            flex-shrink: 0;
        }

        .archive-year-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
        }

        .archive-year-stats {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }

        .archive-badge {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 999px;
            background: color-mix(in oklab, var(--accent), transparent 88%);
            color: color-mix(in oklab, var(--accent), #000 22%);
            border: 1px solid color-mix(in oklab, var(--accent), transparent 70%);
        }

        /* è¡¨æ ¼å¼æ–‡ç« åˆ—è¡¨ */
        .archive-table {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .archive-row {
            display: grid;
            grid-template-columns: 72px 1fr 220px;
            gap: 0;
            align-items: center;
            padding: 12px 16px;
            border-top: 1px dashed var(--border);
            transition: background .2s ease;
        }

        .archive-row:first-child {
            border-top: none;
        }

        .archive-row:hover {
            background: color-mix(in oklab, var(--accent) 4%, transparent);
        }

        .archive-col-day {
            font-variant-numeric: tabular-nums;
            font-weight: 800;
            color: color-mix(in oklab, var(--text), #000 18%);
            font-size: 14px;
        }

        .archive-col-title {
            min-width: 0;
        }

        .archive-col-title a {
            color: var(--text);
            text-decoration: none;
            border-bottom: 2px solid transparent;
            transition: color .2s ease, border-color .2s ease;
            font-weight: 500;
            font-size: 15px;
        }

        .archive-col-title a:hover {
            color: var(--text);
            border-color: var(--border);
        }

        .archive-col-title .small {
            color: var(--muted);
            font-size: 12px;
            margin-left: 8px;
        }

        .archive-col-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-self: end;
        }

        .archive-tag-ghost {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 999px;
            background: var(--surface-alt);
            border: 1px solid var(--border);
            color: var(--muted);
            text-decoration: none;
            transition: background .2s ease;
        }

        .archive-tag-ghost:hover {
            background: var(--border);
        }

        /* å“åº”å¼ä¼˜åŒ– - Ledger é£æ ¼ */
        @media (max-width: 768px) {
            .archive-timeline {
                max-width: 100%;
            }

            .archive-year-header {
                padding: 10px 12px;
                gap: 8px;
            }

            .archive-year-stats {
                flex-direction: column;
                gap: 4px;
                align-items: flex-end;
            }
        }

        @media (max-width: 720px) {
            .archive-row {
                grid-template-columns: 64px 1fr;
            }

            .archive-col-tags {
                grid-column: 2;
                justify-self: start;
                margin-top: 6px;
            }
        }

        .excerpt {
            color: var(--muted);
            font-size: 14px;
            line-height: 1.65;
            min-height: 42px;
            margin: 8px 0 12px 0;
        }

        .readmore {
            align-self: start;
        }

        /* æ–‡ç« é¡µ */
        .article {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .article-hd {
            padding: 20px 20px 10px;
            border-bottom: 1px solid var(--border);
        }

        .article-hd h1 {
            margin: 0 0 6px;
            font-size: 26px;
        }

        .article-bd {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }

        @media (min-width: 980px) {
            .article-bd {
                grid-template-columns: 1fr 240px;
            }
        }

        .article-content {
            padding: 4px 20px 24px;
        }

        .article-aside {
            padding: 14px;
            border-left: 1px solid var(--border);
        }

        .article-content h2 {
            font-size: 20px;
            margin: 22px 0 8px;
        }

        .article-content h3 {
            font-size: 17px;
            margin: 18px 0 6px;
        }

        .article-content p {
            margin: 12px 0;
        }

        .article-content blockquote {
            margin: 12px 0;
            padding: 10px 12px;
            border-left: 3px solid color-mix(in oklab, var(--accent) 40%, #fff);
            background: var(--surface-2);
            border-radius: 10px;
        }

        .article-content code {
            background: var(--code-bg);
            color: var(--code-text);
            padding: 2px 6px;
            border-radius: 6px;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
            font-size: .9em;
        }

        .article-content pre {
            background: var(--code-bg);
            color: var(--code-text);
            padding: 12px 14px;
            border-radius: 12px;
            overflow: auto;
            border: 1px solid var(--border);
        }

        /* ä»£ç å—ä¸­çš„æ–‡å­—é€‰æ‹© */
        .article-content pre ::selection,
        .article-content code ::selection {
            background: color-mix(in oklab, var(--accent) 40%, transparent);
            color: var(--code-text);
        }

        .article-content pre ::-moz-selection,
        .article-content code ::-moz-selection {
            background: color-mix(in oklab, var(--accent) 40%, transparent);
            color: var(--code-text);
        }

        .toc {
            font-size: 13px;
            position: sticky;
            top: 80px;
        }

        .toc h4 {
            margin: 0 0 8px;
            font-size: 12px;
            color: var(--muted);
            letter-spacing: .3px;
        }

        .toc a {
            display: block;
            padding: 6px 8px;
            border-radius: 8px;
            color: var(--muted);
            cursor: pointer;
            transition: all .2s ease;
            border-left: 2px solid transparent;
        }

        .toc a:hover {
            background: color-mix(in oklab, var(--accent) 5%, transparent);
            color: var(--text);
        }

        .toc a[aria-current="true"] {
            background: color-mix(in oklab, var(--accent) 10%, transparent);
            color: var(--accent);
            border-left-color: var(--accent);
            font-weight: 500;
        }

        .progress {
            height: 2px;
            background: color-mix(in oklab, var(--accent) 30%, #fff);
            transform-origin: 0 50%;
            transform: scaleX(var(--p, 0));
            transition: transform .1s ease;
        }

        .section {
            margin: 16px 0 10px;
            display: flex;
            align-items: baseline;
            justify-content: space-between;
        }

        .section h2 {
            margin: 0;
            font-size: 15px;
            letter-spacing: .4px;
        }

        .count {
            color: var(--muted);
            font-size: 12px;
        }

        .empty {
            text-align: center;
            color: var(--muted);
            padding: 40px 0 80px;
        }

        footer {
            width: var(--container);
            margin: 40px auto 80px;
            color: var(--muted);
            text-align: center;
        }

        dialog {
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            border-radius: 12px;
            width: min(780px, 92vw);
            box-shadow: var(--shadow);
        }

        dialog::backdrop {
            background: rgba(0, 0, 0, .35);
            backdrop-filter: blur(2px);
        }

        .dialog-hd {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .dialog-bd {
            padding: 14px;
        }

        textarea.code {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            padding: 10px 12px;
            font: 12px/1.5 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        }

        .sidebar-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 14px;
            box-shadow: var(--shadow);
        }

        .avatar {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: url('./assets/avatar.png') center/cover;
            display: inline-block;
        }

        /* å³é”®èœå• */
        .context-menu {
            position: fixed;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 4px 0;
            z-index: 1000;
            min-width: 120px;
            display: none;
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text);
            transition: background .2s ease;
        }

        .context-menu-item:hover {
            background: color-mix(in oklab, var(--accent) 10%, transparent);
        }

        .context-menu-divider {
            height: 1px;
            background: var(--border);
            margin: 4px 0;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* é”®ç›˜å¯¼èˆª */
        .card[tabindex]:focus {
            outline: none;
            box-shadow: var(--focus);
        }

        @media (prefers-reduced-motion: reduce) {

            .btn,
            .card,
            .progress {
                transition: none;
            }

            .loading::after {
                animation: none;
            }
        }
    </style>
</head>

<body>
    <header class="topbar" role="banner">
        <div class="topbar-inner">
            <a class="brand" href="#/" aria-label="ç«™ç‚¹å“ç‰Œ">
                <div class="logo" aria-hidden="true"></div>
                <div>
                    <div class="brand-title">ä¼˜é›…Â·ç®€çº¦ä¸ªäººç«™</div>
                    <div class="muted" style="font-size:12px">å¯¼èˆª / åšå®¢ / æœç´¢ / æ ‡ç­¾</div>
                </div>
            </a>
            <div class="actions">
                <div class="nav-tabs" role="tablist" aria-label="ä¸»å¯¼èˆª">
                    <button class="nav-tab" data-section="nav" aria-pressed="true" aria-label="å¯¼èˆª">å¯¼èˆª</button>
                    <button class="nav-tab" data-section="blog" aria-pressed="false" aria-label="åšå®¢">åšå®¢</button>
                </div>
                <button class="btn ghost" id="themeBtn" aria-label="åˆ‡æ¢ä¸»é¢˜" title="åˆ‡æ¢æ˜/æš— (t)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M12 3a9 9 0 100 18 9 9 0 010-18z" stroke="currentColor" stroke-width="1.5" />
                        <path
                            d="M12 2v2m0 16v2m10-10h-2M4 12H2m15.535-7.535l-1.414 1.414M7.879 16.121l-1.414 1.414m0-12.728l1.414 1.414m9.242 9.242l1.414 1.414"
                            stroke="currentColor" stroke-width="1.5" />
                    </svg>
                </button>
                <button class="btn" id="accentBtn" aria-label="ä¸»é¢˜è‰²" title="ä¸»é¢˜è‰²">
                    <span
                        style="width:12px;height:12px;border-radius:999px;background:var(--accent);display:inline-block"></span>
                    ä¸»é¢˜è‰²
                </button>
                <button class="btn" id="ioBtn" aria-label="å¯¼å…¥å¯¼å‡º" title="å¯¼å…¥/å¯¼å‡º (i)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M12 3v12m0 0l-3-3m3 3l3-3M4 17v2a2 2 0 002 2h12a2 2 0 002-2v-2" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    æ•°æ®
                </button>
                <button class="btn" id="helpBtn" aria-label="å¸®åŠ©" title="å¿«æ·é”® (?)">å¸®åŠ©</button>
            </div>
        </div>
        <div class="progress" id="progress"></div>
    </header>

    <main class="wrap layout" id="app" role="main">
        <div>
            <section class="search" aria-label="æœç´¢">
                <svg class="iconL" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 110-15 7.5 7.5 0 010 15z" stroke="currentColor"
                        stroke-width="1.5" stroke-linecap="round" />
                </svg>
                <input id="q" type="search" placeholder="æœç´¢å†…å®¹ï¼ˆæŒ‰ / èšç„¦ï¼‰" autocomplete="off" aria-label="æœç´¢è¾“å…¥" />
                <button class="clear-btn" id="clearSearchBtn" title="æ¸…é™¤æœç´¢" aria-label="æ¸…é™¤æœç´¢">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
                <div class="iconR kbd">/</div>
            </section>

            <!-- å¯¼èˆªä¸“ç”¨æ§ä»¶ -->
            <div id="navControls" style="display:none">
                <div class="viewtabs" role="tablist" aria-label="è§†å›¾" style="margin-bottom:10px">
                    <button class="tab" data-view="all" aria-pressed="true" aria-label="å…¨éƒ¨">å…¨éƒ¨</button>
                    <button class="tab" data-view="bycat" aria-pressed="false" aria-label="æŒ‰åˆ†ç»„">æŒ‰åˆ†ç»„</button>
                </div>
            </div>

            <!-- åšå®¢ä¸“ç”¨æ§ä»¶ -->
            <div id="blogControls" style="display:none">
                <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
                    <button class="btn ghost" id="homeBtn">é¦–é¡µ</button>
                    <button class="btn ghost" id="archiveBtn">å½’æ¡£</button>
                    <button class="btn ghost" id="tagsBtn">æ ‡ç­¾</button>
                </div>
            </div>

            <nav class="tagbar" id="tagbar" aria-label="æ ‡ç­¾ç­›é€‰"></nav>
            <div id="content"></div>
            <div class="empty" id="empty" hidden>æ²¡æœ‰åŒ¹é…çš„ç»“æœï¼Œæ¢ä¸ªå…³é”®è¯æˆ–æ ‡ç­¾è¯•è¯•ã€‚</div>
            <div style="display:flex;justify-content:center;margin-top:14px" id="moreWrap"></div>
        </div>

        <aside class="sidebar" aria-label="ä¾§æ ">
            <div class="sidebar-card" style="display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:center">
                <div class="avatar" aria-hidden="true"></div>
                <div>
                    <div style="font-weight:700">ä½ çš„ä¸ªäººç«™</div>
                    <div class="muted" style="font-size:13px">å¯¼èˆªæ”¶è— + åšå®¢å†™ä½œï¼Œä¸€ç«™å¼ä¸ªäººç©ºé—´ã€‚</div>
                </div>
            </div>
            <div class="sidebar-card" style="margin-top:12px">
                <div class="section" style="margin-top:0">
                    <h2 id="sidebarTitle">æ ‡ç­¾äº‘</h2>
                </div>
                <div id="sidebarContent" style="display:flex;flex-wrap:wrap;gap:8px"></div>
            </div>
            <div class="sidebar-card" style="margin-top:12px">
                <div class="section" style="margin-top:0">
                    <h2>å…³äº</h2>
                </div>
                <p class="muted" style="margin-top:6px">æ­¤ç«™ç‚¹ä¸ºå•æ–‡ä»¶ç‰ˆï¼Œå¯ç¦»çº¿éƒ¨ç½²ã€‚é›†æˆå¯¼èˆªå’Œåšå®¢åŠŸèƒ½ï¼Œæ‰€æœ‰æ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨
                    <code>localStorage</code>ï¼Œä¹Ÿå¯å¯¼å…¥/å¯¼å‡º
                    JSONã€‚
                </p>
            </div>
        </aside>
    </main>

    <footer>
        <small>æŒ‰ <b>/</b> æœç´¢ Â· <b>t</b> åˆ‡æ¢ä¸»é¢˜ Â· <b>i</b> å¯¼å…¥å¯¼å‡º Â· <b>?</b> å¸®åŠ© Â· æ”¯æŒå¯¼èˆªæ”¶è—ä¸åšå®¢å†™ä½œã€‚</small>
    </footer>

    <!-- å³é”®èœå• -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" data-action="copy">å¤åˆ¶é“¾æ¥</div>
        <div class="context-menu-item" data-action="open">åœ¨æ–°æ ‡ç­¾æ‰“å¼€</div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" data-action="edit">ç¼–è¾‘</div>
        <div class="context-menu-item" data-action="delete">åˆ é™¤</div>
    </div> <!--
 å¯¼å…¥/å¯¼å‡ºå¯¹è¯æ¡† -->
    <dialog id="ioDialog" aria-label="å¯¼å…¥ä¸å¯¼å‡º">
        <div class="dialog-hd">
            <strong>å¯¼å…¥ / å¯¼å‡ºæ•°æ®ï¼ˆJSONï¼‰</strong>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
                <button class="btn ghost" id="exportRssBtn" style="display:none">å¯¼å‡º RSS</button>
                <button class="btn ghost" id="downloadBtn">å¯¼å‡ºä¸ºæ–‡ä»¶</button>
                <button class="btn" id="saveJsonBtn">ä¿å­˜æ›´æ”¹</button>
                <button class="btn ghost" id="closeIo">å…³é—­</button>
            </div>
        </div>
        <div class="dialog-bd">
            <p class="muted" style="margin-top:0" id="ioHint">æ•°æ®ç»“æ„ç¤ºä¾‹</p>
            <textarea class="code" id="jsonArea" spellcheck="false"></textarea>
        </div>
    </dialog>

    <!-- å¸®åŠ©å¯¹è¯æ¡† -->
    <dialog id="helpDialog" aria-label="å¸®åŠ©ä¸å¿«æ·é”®">
        <div class="dialog-hd">
            <strong>å¸®åŠ©</strong>
            <button class="btn ghost" id="closeHelp">å…³é—­</button>
        </div>
        <div class="dialog-bd">
            <ul>
                <li>æŒ‰ <b>/</b> èšç„¦æœç´¢ï¼›æ”¯æŒæŒ‰æ ‡é¢˜ã€æè¿°ã€æ­£æ–‡ä¸æ ‡ç­¾æœç´¢ã€‚</li>
                <li>ç‚¹å‡»æ ‡ç­¾è¿›è¡Œç­›é€‰ï¼Œå¯å¤šé€‰ï¼›å†æ¬¡ç‚¹å‡»å–æ¶ˆã€‚</li>
                <li>æŒ‰ <b>t</b> åˆ‡æ¢æ˜/æš—ä¸»é¢˜ï¼›ç‚¹å‡»"ä¸»é¢˜è‰²"å¯æ¢ä¸»è‰²ã€‚</li>
                <li>æŒ‰ <b>i</b> æ‰“å¼€å¯¼å…¥/å¯¼å‡ºï¼›ä¿®æ”¹ JSON å¯å¿«é€Ÿæ‰¹é‡ç»´æŠ¤æ•°æ®ã€‚</li>
                <li><b>å¯¼èˆªæ¨¡å¼</b>ï¼šæ”¶è—ç½‘ç«™é“¾æ¥ï¼Œæ”¯æŒåˆ†ç»„ç®¡ç†ã€‚å³é”®å¡ç‰‡å¯å¤åˆ¶é“¾æ¥ã€‚</li>
                <li><b>åšå®¢æ¨¡å¼</b>ï¼šå†™ä½œæ–‡ç« ï¼Œæ”¯æŒè·¯ç”±ã€å½’æ¡£ã€RSS å¯¼å‡ºã€‚</li>
                <li><b>é”®ç›˜å¯¼èˆª</b>ï¼šTab é”®åœ¨å¡ç‰‡é—´å¯¼èˆªï¼ŒEnter æ‰“å¼€é“¾æ¥ã€‚</li>
            </ul>
        </div>
    </dialog>

    <!-- ä¸»é¢˜è‰²é€‰æ‹©å¯¹è¯æ¡† -->
    <dialog id="accentDialog" aria-label="ä¸»é¢˜è‰²">
        <div class="dialog-hd">
            <strong>é€‰æ‹©ä¸»é¢˜è‰²</strong>
            <button class="btn ghost" id="closeAccent">å…³é—­</button>
        </div>
        <div class="dialog-bd">
            <div style="display:flex;flex-wrap:wrap;gap:10px">
                <button class="btn" data-accent="#000000"><span
                        style="width:12px;height:12px;border-radius:999px;background:#000000;display:inline-block"></span>
                    é»‘</button>
                <button class="btn" data-accent="#6aa1ff"><span
                        style="width:12px;height:12px;border-radius:999px;background:#6aa1ff;display:inline-block"></span>
                    è“</button>
                <button class="btn" data-accent="#22c55e"><span
                        style="width:12px;height:12px;border-radius:999px;background:#22c55e;display:inline-block"></span>
                    ç»¿</button>
                <button class="btn" data-accent="#ef4444"><span
                        style="width:12px;height:12px;border-radius:999px;background:#ef4444;display:inline-block"></span>
                    çº¢</button>
                <button class="btn" data-accent="#a855f7"><span
                        style="width:12px;height:12px;border-radius:999px;background:#a855f7;display:inline-block"></span>
                    ç´«</button>
                <button class="btn" data-accent="#f59e0b"><span
                        style="width:12px;height:12px;border-radius:999px;background:#f59e0b;display:inline-block"></span>
                    æ©™</button>
                <button class="btn" data-accent="#14b8a6"><span
                        style="width:12px;height:12px;border-radius:999px;background:#14b8a6;display:inline-block"></span>
                    é’</button>
            </div>
        </div>
    </dialog>

    <script>
        // ===== ç¤ºä¾‹æ•°æ® =====
        const DEFAULT_DATA = {
            // å¯¼èˆªæ•°æ®
            collections: [
                {
                    name: "AI / å¤§æ¨¡å‹",
                    links: [
                        { title: "OpenAI", url: "https://openai.com", desc: "é¢†å…ˆçš„é€šç”¨äººå·¥æ™ºèƒ½ç ”ç©¶ä¸äº§å“ã€‚", tags: ["AI", "å¤§æ¨¡å‹"] },
                        { title: "Anthropic Claude", url: "https://claude.ai", desc: "å®‰å…¨å¯¼å‘çš„å¯¹è¯å¼ AIã€‚", tags: ["AI"] },
                        { title: "Qwen", url: "https://modelscope.cn/models?q=qwen", desc: "é˜¿é‡Œå·´å·´é€šä¹‰åƒé—®å¼€æºç”Ÿæ€å…¥å£ã€‚", tags: ["AI", "å¼€æº"] },
                        { title: "Hugging Face", url: "https://huggingface.co", desc: "æœºå™¨å­¦ä¹ æ¨¡å‹ä¸æ•°æ®ç¤¾åŒºã€‚", tags: ["AI", "å¼€æº", "ç¤¾åŒº"] },
                    ]
                },
                {
                    name: "è®¾è®¡ / çµæ„Ÿ",
                    links: [
                        { title: "Figma", url: "https://www.figma.com", desc: "åä½œå¼è®¾è®¡å·¥å…·ã€‚", tags: ["è®¾è®¡", "UI"] },
                        { title: "Dribbble", url: "https://dribbble.com", desc: "è®¾è®¡çµæ„Ÿç¤¾åŒºã€‚", tags: ["è®¾è®¡", "çµæ„Ÿ"] },
                        { title: "Behance", url: "https://www.behance.net", desc: "ä½œå“é›†å±•ç¤ºå¹³å°ã€‚", tags: ["è®¾è®¡", "ä½œå“é›†"] },
                        { title: "Muzli", url: "https://muz.li", desc: "æ¯æ—¥çµæ„Ÿä¸è¶‹åŠ¿ã€‚", tags: ["çµæ„Ÿ"] },
                    ]
                },
                {
                    name: "å¼€å‘ / æ–‡æ¡£",
                    links: [
                        { title: "GitHub", url: "https://github.com", desc: "å…¨çƒæœ€å¤§å¼€æºæ‰˜ç®¡å¹³å°ã€‚", tags: ["å¼€å‘", "å¼€æº"] },
                        { title: "MDN Web Docs", url: "https://developer.mozilla.org", desc: "Web æ ‡å‡†ä¸ API æ–‡æ¡£ã€‚", tags: ["Web", "æ–‡æ¡£"] },
                        { title: "Vercel", url: "https://vercel.com", desc: "å‰ç«¯ä¸å…¨æ ˆéƒ¨ç½²å¹³å°ã€‚", tags: ["éƒ¨ç½²", "å‰ç«¯"] },
                        { title: "Stack Overflow", url: "https://stackoverflow.com", desc: "ç¨‹åºå‘˜é—®ç­”ç¤¾åŒºã€‚", tags: ["å¼€å‘", "ç¤¾åŒº"] },
                    ]
                }
            ],
            // åšå®¢æ•°æ®
            posts: [
                {
                    id: 1,
                    title: "ä¸ªäººç«™ç‚¹çš„æ–°å°è¯•ï¼šå¯¼èˆª + åšå®¢åˆä¸€",
                    slug: "personal-site-integration",
                    date: "2025-08-14",
                    tags: ["è®¾è®¡", "å‰ç«¯", "ä¸ªäººç«™ç‚¹"],
                    pinned: true,
                    content: `
            <p>å°†å¯¼èˆªå’Œåšå®¢åŠŸèƒ½åˆå¹¶åˆ°ä¸€ä¸ªé¡µé¢ï¼Œæ—¢èƒ½æ”¶è—æœ‰ç”¨çš„é“¾æ¥ï¼Œåˆèƒ½è®°å½•æ€è€ƒå’Œåˆ†äº«ã€‚è¿™ç§è®¾è®¡è®©ä¸ªäººç«™ç‚¹æ›´åŠ å®ç”¨ã€‚</p>
            <h2 id="why">ä¸ºä»€ä¹ˆè¦åˆå¹¶</h2>
            <ul>
              <li>å‡å°‘ç»´æŠ¤æˆæœ¬ï¼šä¸€ä¸ªæ–‡ä»¶æå®šæ‰€æœ‰åŠŸèƒ½ã€‚</li>
              <li>ç»Ÿä¸€ä½“éªŒï¼šç›¸åŒçš„è®¾è®¡è¯­è¨€å’Œäº¤äº’æ¨¡å¼ã€‚</li>
              <li>æ•°æ®äº’é€šï¼šæ ‡ç­¾ç³»ç»Ÿå¯ä»¥è·¨å¯¼èˆªå’Œåšå®¢ä½¿ç”¨ã€‚</li>
            </ul>
            <h2 id="features">ä¸»è¦åŠŸèƒ½</h2>
            <p>å¯¼èˆªæ¨¡å¼æ”¯æŒé“¾æ¥æ”¶è—ã€åˆ†ç»„ç®¡ç†ã€æ ‡ç­¾ç­›é€‰ï¼›åšå®¢æ¨¡å¼æ”¯æŒæ–‡ç« å†™ä½œã€å½’æ¡£æµè§ˆã€RSS å¯¼å‡ºã€‚</p>
            <blockquote>"ç®€å•çš„å·¥å…·ï¼Œå¾€å¾€æœ€å®ç”¨ã€‚"</blockquote>
          `
                },
                {
                    id: 2,
                    title: "å•æ–‡ä»¶åº”ç”¨çš„è®¾è®¡å“²å­¦",
                    slug: "single-file-philosophy",
                    date: "2025-08-13",
                    tags: ["è®¾è®¡", "æç®€"],
                    pinned: true,
                    featured: true,
                    content: `
            <p>å•æ–‡ä»¶åº”ç”¨å¼ºè¿«æˆ‘ä»¬æ€è€ƒä»€ä¹ˆæ˜¯çœŸæ­£å¿…è¦çš„åŠŸèƒ½ã€‚å»æ‰ä¸å¿…è¦çš„å¤æ‚æ€§ï¼Œä¸“æ³¨æ ¸å¿ƒä»·å€¼ã€‚</p>
            <h3>è®¾è®¡åŸåˆ™</h3>
            <ol>
              <li>åŠŸèƒ½èšç„¦ï¼šæ¯ä¸ªåŠŸèƒ½éƒ½è¦æœ‰æ˜ç¡®ä»·å€¼ã€‚</li>
              <li>æ•°æ®å¯æ§ï¼šç”¨æˆ·å®Œå…¨æŒæ§è‡ªå·±çš„æ•°æ®ã€‚</li>
              <li>ä½“éªŒä¸€è‡´ï¼šç»Ÿä¸€çš„è§†è§‰å’Œäº¤äº’è¯­è¨€ã€‚</li>
            </ol>
          `
                },
                {
                    id: 3,
                    title: "ä¿¡æ¯å±‚çº§è®¾è®¡ï¼šä»é˜…è¯»è·¯å¾„åˆ°ç‚¹å‡»åŠ¨æœº",
                    slug: "information-hierarchy-design",
                    date: "2025-07-07",
                    tags: ["æ’ç‰ˆ", "UX"],
                    content: `
            <p>æ ‡é¢˜è´Ÿè´£"æŠ“ä½æ³¨æ„åŠ›"ï¼Œæ‘˜è¦è´Ÿè´£"å»ºç«‹é¢„æœŸ"ï¼Œæ ‡ç­¾è´Ÿè´£"é™ä½ä¸ç¡®å®š"ã€‚</p>
            <h2>è§†è§‰å±‚æ¬¡çš„æ„å»º</h2>
            <p>é€šè¿‡å­—ä½“å¤§å°ã€é¢œè‰²å¯¹æ¯”ã€é—´è·æ§åˆ¶æ¥å¼•å¯¼ç”¨æˆ·çš„è§†çº¿æµåŠ¨ã€‚æ¯ä¸ªå…ƒç´ éƒ½æœ‰å…¶å­˜åœ¨çš„ç†ç”±ã€‚</p>
            <h2>äº¤äº’åé¦ˆ</h2>
            <p>æ‚¬åœã€ç‚¹å‡»ã€åŠ è½½çŠ¶æ€éƒ½éœ€è¦ç»™ç”¨æˆ·æ˜ç¡®çš„åé¦ˆï¼Œè®©æ“ä½œå˜å¾—å¯é¢„æœŸã€‚</p>
          `
                },
                {
                    id: 4,
                    title: "CSS å˜é‡ç³»ç»Ÿçš„æœ€ä½³å®è·µ",
                    slug: "css-variables-best-practices",
                    date: "2025-06-15",
                    tags: ["CSS", "å‰ç«¯", "è®¾è®¡ç³»ç»Ÿ"],
                    content: `
            <p>ä½¿ç”¨ CSS å˜é‡æ„å»ºä¸€è‡´çš„è®¾è®¡ç³»ç»Ÿï¼Œè®©ä¸»é¢˜åˆ‡æ¢å’Œç»´æŠ¤å˜å¾—ç®€å•ã€‚</p>
            <h2>å‘½åè§„èŒƒ</h2>
            <p>ä½¿ç”¨è¯­ä¹‰åŒ–çš„å‘½åï¼Œå¦‚ --textã€--surfaceã€--accentï¼Œè€Œä¸æ˜¯ --blueã€--grayã€‚</p>
            <h2>åˆ†å±‚ç®¡ç†</h2>
            <p>åŸºç¡€å˜é‡å®šä¹‰é¢œè‰²å€¼ï¼Œè¯­ä¹‰å˜é‡å®šä¹‰ç”¨é€”ï¼Œç»„ä»¶å˜é‡å®šä¹‰å…·ä½“åº”ç”¨ã€‚</p>
          `
                },
                {
                    id: 5,
                    title: "å“åº”å¼è®¾è®¡çš„æ¸è¿›å¢å¼ºç­–ç•¥",
                    slug: "responsive-progressive-enhancement",
                    date: "2025-05-20",
                    tags: ["å“åº”å¼", "ç§»åŠ¨ç«¯", "å‰ç«¯"],
                    content: `
            <p>ä»ç§»åŠ¨ç«¯å¼€å§‹è®¾è®¡ï¼Œé€æ­¥å¢å¼ºåˆ°æ¡Œé¢ç«¯ã€‚è¿™ç§æ–¹å¼èƒ½ç¡®ä¿æ ¸å¿ƒåŠŸèƒ½åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šéƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
            <h2>æ–­ç‚¹é€‰æ‹©</h2>
            <p>åŸºäºå†…å®¹è€Œä¸æ˜¯è®¾å¤‡æ¥é€‰æ‹©æ–­ç‚¹ã€‚å½“å†…å®¹å¼€å§‹æ˜¾å¾—æ‹¥æŒ¤æ—¶ï¼Œå°±æ˜¯æ·»åŠ æ–­ç‚¹çš„æ—¶å€™ã€‚</p>
          `
                },
                {
                    id: 6,
                    title: "JavaScript æ¨¡å—åŒ–çš„æ¼”è¿›å†ç¨‹",
                    slug: "javascript-modules-evolution",
                    date: "2025-04-10",
                    tags: ["JavaScript", "æ¨¡å—åŒ–", "å‰ç«¯"],
                    content: `
            <p>ä»å…¨å±€å˜é‡åˆ° CommonJSï¼Œä» AMD åˆ° ES6 æ¨¡å—ï¼ŒJavaScript çš„æ¨¡å—åŒ–æ–¹æ¡ˆä¸æ–­æ¼”è¿›ã€‚</p>
            <h2>ç°ä»£æ¨¡å—ç³»ç»Ÿ</h2>
            <p>ES6 æ¨¡å—æä¾›äº†é™æ€åˆ†æã€æ ‘æ‘‡ä¼˜åŒ–ç­‰ä¼˜åŠ¿ï¼Œæˆä¸ºäº†ç°ä»£å‰ç«¯å¼€å‘çš„æ ‡å‡†ã€‚</p>
          `
                },
                {
                    id: 7,
                    title: "Web æ€§èƒ½ä¼˜åŒ–çš„ç³»ç»Ÿæ€§æ€è€ƒ",
                    slug: "web-performance-optimization",
                    date: "2025-03-25",
                    tags: ["æ€§èƒ½ä¼˜åŒ–", "å‰ç«¯", "ç”¨æˆ·ä½“éªŒ"],
                    content: `
            <p>æ€§èƒ½ä¼˜åŒ–ä¸ä»…ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ›´æ˜¯ç”¨æˆ·ä½“éªŒé—®é¢˜ã€‚éœ€è¦ä»ç”¨æˆ·æ„ŸçŸ¥çš„è§’åº¦æ¥æ€è€ƒä¼˜åŒ–ç­–ç•¥ã€‚</p>
            <h2>å…³é”®æ¸²æŸ“è·¯å¾„</h2>
            <p>ç†è§£æµè§ˆå™¨å¦‚ä½•è§£æå’Œæ¸²æŸ“é¡µé¢ï¼Œæ‰¾åˆ°æ€§èƒ½ç“¶é¢ˆçš„æ ¹æœ¬åŸå› ã€‚</p>
          `
                },
                {
                    id: 8,
                    title: "è®¾è®¡ç³»ç»Ÿçš„æ„å»ºä¸ç»´æŠ¤",
                    slug: "design-system-building",
                    date: "2025-02-14",
                    tags: ["è®¾è®¡ç³»ç»Ÿ", "ç»„ä»¶åŒ–", "å›¢é˜Ÿåä½œ"],
                    content: `
            <p>è®¾è®¡ç³»ç»Ÿä¸ä»…ä»…æ˜¯ç»„ä»¶åº“ï¼Œæ›´æ˜¯å›¢é˜Ÿåä½œçš„è¯­è¨€ã€‚å®ƒéœ€è¦åœ¨ä¸€è‡´æ€§å’Œçµæ´»æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚</p>
            <h2>ç»„ä»¶è®¾è®¡åŸåˆ™</h2>
            <p>æ¯ä¸ªç»„ä»¶éƒ½åº”è¯¥æœ‰æ˜ç¡®çš„èŒè´£ï¼Œå¯ç»„åˆï¼Œå¯æ‰©å±•ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨ã€‚</p>
          `
                }
            ]
        };

        // ===== çŠ¶æ€ä¸æŒä¹…åŒ– =====
        const STORAGE_KEY = 'personal.site.v1';
        const THEME_KEY = 'personal.theme';
        const ACCENT_KEY = 'personal.accent';

        const state = {
            data: loadData(),
            section: 'nav', // 'nav' | 'blog'
            view: 'all', // å¯¼èˆªè§†å›¾ï¼š'all' | 'bycat'
            q: '',
            tags: new Set(),
            pageSize: 8,
            page: 1,
            currentCard: null, // å½“å‰å³é”®ç‚¹å‡»çš„å¡ç‰‡
            focusedCardIndex: -1, // é”®ç›˜å¯¼èˆªç„¦ç‚¹
        };

        function loadData() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return structuredClone(DEFAULT_DATA);
                const parsed = JSON.parse(raw);
                // ç¡®ä¿æ•°æ®ç»“æ„å®Œæ•´
                if (!parsed.collections) parsed.collections = [];
                if (!parsed.posts) parsed.posts = [];
                return parsed;
            } catch (e) {
                console.warn('æ•°æ®è§£æå¤±è´¥ï¼Œå·²å›é€€é»˜è®¤æ•°æ®', e);
                return structuredClone(DEFAULT_DATA);
            }
        }
        function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state.data)); }

        // ===== ä¸»é¢˜ä¸ä¸»é¢˜è‰² =====
        initTheme();
        function initTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY);
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
            const savedAccent = localStorage.getItem(ACCENT_KEY);
            if (savedAccent) document.documentElement.style.setProperty('--accent', savedAccent);
        }
        function toggleTheme() {
            const cur = document.documentElement.getAttribute('data-theme');
            const next = cur === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem(THEME_KEY, next);
        }

        // ===== å·¥å…·å‡½æ•° =====
        const $ = (sel, el = document) => el.querySelector(sel);
        const $$ = (sel, el = document) => Array.from(el.querySelectorAll(sel));
        const escapeHTML = (s = '') => s.replace(/[&<>"']/g, c => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#39;" }[c]));
        const debounce = (fn, d = 150) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), d); } };
        const stripHTML = (html = '') => html.replace(/<[^>]*>/g, '');
        const fmtDate = (d) => new Date(d).toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
        function slugify(s) { return s.toLowerCase().trim().replace(/[^a-z0-9\u4e00-\u9fa5]+/g, '-').replace(/^-+|-+$/g, ''); }

        // ===== æ ‡ç­¾èšåˆ =====
        function collectNavTags() {
            const m = new Map();
            for (const g of state.data.collections) {
                for (const l of g.links) {
                    (l.tags || []).forEach(t => m.set(t, (m.get(t) || 0) + 1));
                }
            }
            return [...m.entries()].sort((a, b) => a[0].localeCompare(b[0], 'zh-Hans-CN'));
        }

        function collectBlogTags() {
            const m = new Map();
            for (const p of state.data.posts) { (p.tags || []).forEach(t => m.set(t, (m.get(t) || 0) + 1)); }
            return [...m.entries()].sort((a, b) => a[0].localeCompare(b[0], 'zh-Hans-CN'));
        }

        function renderTagsBar() {
            const bar = $('#tagbar');
            const items = state.section === 'nav' ? collectNavTags() : collectBlogTags();

            // æ„å»ºæ ‡ç­¾æŒ‰é’®
            let tagsHTML = items.map(([tag, count]) => `
                <button class="chip" data-tag="${escapeHTML(tag)}" data-active="${state.tags.has(tag)}" aria-pressed="${state.tags.has(tag)}">
                    #${escapeHTML(tag)} <span class="muted" style="margin-left:6px">${count}</span>
                </button>
            `).join('');

            // å¦‚æœæœ‰é€‰ä¸­çš„æ ‡ç­¾ï¼Œæ·»åŠ æ¸…é™¤æŒ‰é’®
            if (state.tags.size > 0) {
                tagsHTML = `
                    <button class="btn ghost" id="clearTagsBtn" style="height:34px;padding:0 12px;margin-right:8px;" title="æ¸…é™¤æ‰€æœ‰ç­›é€‰">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                        æ¸…é™¤ç­›é€‰
                    </button>
                ` + tagsHTML;
            }

            bar.innerHTML = tagsHTML;

            // ç»‘å®šæ ‡ç­¾ç‚¹å‡»äº‹ä»¶
            $$('#tagbar .chip').forEach(btn => {
                btn.addEventListener('click', () => {
                    const t = btn.dataset.tag;
                    if (state.tags.has(t)) state.tags.delete(t); else state.tags.add(t);
                    renderTagsBar(); // é‡æ–°æ¸²æŸ“æ ‡ç­¾æ¡ä»¥æ›´æ–°æ¸…é™¤æŒ‰é’®çŠ¶æ€
                    renderContent(); renderSidebar();
                });
            });

            // ç»‘å®šæ¸…é™¤æŒ‰é’®äº‹ä»¶
            const clearBtn = $('#clearTagsBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', () => {
                    state.tags.clear();
                    renderContent(); renderSidebar();
                });
            }
        }

        function renderSidebar() {
            const sidebarTitle = $('#sidebarTitle');
            const sidebarContent = $('#sidebarContent');

            if (state.section === 'nav') {
                sidebarTitle.textContent = 'æ ‡ç­¾äº‘';
                const items = collectNavTags();
                sidebarContent.innerHTML = items.map(([t, c]) => {
                    const scale = Math.min(1.6, 1 + Math.log(1 + c) / 3);
                    return `<span style="font-size:${(12 * scale).toFixed(1)}px" class="t">#${escapeHTML(t)}<sup class="muted" style="margin-left:4px">${c}</sup></span>`;
                }).join(' ');
            } else {
                sidebarTitle.textContent = 'æ ‡ç­¾äº‘';
                const items = collectBlogTags();
                const maxTags = 8; // æœ€å¤šæ˜¾ç¤º8ä¸ªæ ‡ç­¾
                const visibleItems = items.slice(0, maxTags);
                const hiddenItems = items.slice(maxTags);

                let tagsHTML = visibleItems.map(([t, c]) => {
                    const scale = Math.min(1.6, 1 + Math.log(1 + c) / 3);
                    const isActive = state.tags.has(t);
                    return `<button style="font-size:${(12 * scale).toFixed(1)}px" class="t sidebar-tag-filter ${isActive ? 'active' : ''}" data-tag="${escapeHTML(t)}">#${escapeHTML(t)}<sup class="muted" style="margin-left:4px">${c}</sup></button>`;
                }).join(' ');

                if (hiddenItems.length > 0) {
                    tagsHTML += ` <button class="t expand-sidebar-tags" style="margin-left: 8px;">å±•å¼€ +${hiddenItems.length}</button>`;
                }

                sidebarContent.innerHTML = tagsHTML;

                // ç»‘å®šä¾§è¾¹æ æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
                $$('.sidebar-tag-filter').forEach(tagBtn => {
                    tagBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tag = tagBtn.dataset.tag;

                        // åˆ‡æ¢æ ‡ç­¾ç­›é€‰çŠ¶æ€
                        if (state.tags.has(tag)) {
                            state.tags.delete(tag);
                        } else {
                            state.tags.add(tag);
                        }

                        // é‡æ–°æ¸²æŸ“
                        renderTagsBar();
                        renderContent();
                        renderSidebar();
                    });
                });

                // ç»‘å®šå±•å¼€æŒ‰é’®äº‹ä»¶
                const expandBtn = $('.expand-sidebar-tags');
                if (expandBtn) {
                    expandBtn.addEventListener('click', (e) => {
                        e.preventDefault();

                        // æ˜¾ç¤ºæ‰€æœ‰æ ‡ç­¾
                        const allTagsHTML = items.map(([t, c]) => {
                            const scale = Math.min(1.6, 1 + Math.log(1 + c) / 3);
                            const isActive = state.tags.has(t);
                            return `<button style="font-size:${(12 * scale).toFixed(1)}px" class="t sidebar-tag-filter ${isActive ? 'active' : ''}" data-tag="${escapeHTML(t)}">#${escapeHTML(t)}<sup class="muted" style="margin-left:4px">${c}</sup></button>`;
                        }).join(' ') + ` <button class="t collapse-sidebar-tags" style="margin-left: 8px;">æ”¶èµ·</button>`;

                        sidebarContent.innerHTML = allTagsHTML;

                        // é‡æ–°ç»‘å®šäº‹ä»¶
                        $$('.sidebar-tag-filter').forEach(tagBtn => {
                            tagBtn.addEventListener('click', (e) => {
                                e.preventDefault();
                                const tag = tagBtn.dataset.tag;
                                if (state.tags.has(tag)) {
                                    state.tags.delete(tag);
                                } else {
                                    state.tags.add(tag);
                                }
                                renderTagsBar();
                                renderContent();
                                renderSidebar();
                            });
                        });

                        // ç»‘å®šæ”¶èµ·æŒ‰é’®
                        const collapseBtn = $('.collapse-sidebar-tags');
                        if (collapseBtn) {
                            collapseBtn.addEventListener('click', () => {
                                renderSidebar(); // é‡æ–°æ¸²æŸ“å›æ”¶èµ·çŠ¶æ€
                            });
                        }
                    });
                }
            }
        }

        // ===== å¯¼èˆªåŠŸèƒ½ =====
        function matchLink(link) {
            const q = state.q.trim().toLowerCase();
            const byQ = !q || (
                (link.title || '').toLowerCase().includes(q) ||
                (link.desc || '').toLowerCase().includes(q) ||
                (link.url || '').toLowerCase().includes(q) ||
                (link.tags || []).some(t => t.toLowerCase().includes(q))
            );
            const byTags = state.tags.size === 0 || (link.tags || []).some(t => state.tags.has(t));
            return byQ && byTags;
        }

        function renderNavigation() {
            const root = $('#content');
            const view = state.view;

            if (view === 'all') {
                const allLinks = state.data.collections.flatMap(g => g.links.map(l => ({ ...l, group: g.name })));
                const filtered = allLinks.filter(matchLink);
                root.innerHTML = `
          <div class="section"><h2>å…¨éƒ¨é“¾æ¥</h2><div class="count">${filtered.length} ä¸ª</div></div>
          <div class="grid nav-grid">${filtered.map(renderNavCard).join('')}</div>
        `;
                $('#empty').hidden = filtered.length > 0;
            } else {
                const html = state.data.collections.map(group => {
                    const items = group.links.filter(matchLink);
                    if (items.length === 0) return '';
                    return `
            <section>
              <div class="section"><h2>${escapeHTML(group.name)}</h2><div class="count">${items.length} ä¸ª</div></div>
              <div class="grid nav-grid">${items.map(renderNavCard).join('')}</div>
            </section>
          `;
                }).join('');
                root.innerHTML = html || '';
                $('#empty').hidden = !!html;
            }

            // ç»‘å®šå¡ç‰‡äº‹ä»¶
            bindCardEvents();
        }

        function renderNavCard(link, index) {
            const { title, url, desc, tags = [] } = link;
            const u = new URL(url);
            const favicon = `https://www.google.com/s2/favicons?domain=${encodeURIComponent(u.origin)}&sz=64`;
            return `
        <article class="card nav-card" role="article" tabindex="0" data-url="${escapeHTML(url)}" data-title="${escapeHTML(title)}" data-index="${index || 0}">
          <button class="open" data-url="${escapeHTML(url)}" aria-label="åœ¨æ–°æ ‡ç­¾æ‰“å¼€">â†—</button>
          <div class="row">
            <img class="favicon" src="${favicon}" alt="${escapeHTML(u.hostname)} favicon" loading="lazy" onerror="this.classList.add('error')" />
            <h3 title="${escapeHTML(url)}">${escapeHTML(title)}</h3>
          </div>
          <div class="desc">${escapeHTML(desc || '')}</div>
          <div class="tags">${tags.map(t => `<span class="t">#${escapeHTML(t)}</span>`).join('')}</div>
        </article>
      `;
        }

        // ===== åšå®¢åŠŸèƒ½ =====
        function matchPost(p) {
            const q = state.q.trim().toLowerCase();
            const byQ = !q || (
                (p.title || '').toLowerCase().includes(q) ||
                stripHTML(p.content || '').toLowerCase().includes(q) ||
                (p.tags || []).some(t => t.toLowerCase().includes(q))
            );
            const byTags = state.tags.size === 0 || (p.tags || []).some(t => state.tags.has(t));
            return byQ && byTags;
        }

        function sortedPosts() {
            return [...state.data.posts]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .sort((a, b) => (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0));
        }

        function renderBlogList() {
            const root = $('#content');
            const allPosts = sortedPosts();
            const posts = allPosts.filter(matchPost);
            const total = posts.length;

            if (total === 0) {
                root.innerHTML = `<div class="section"><h2>æœ€æ–°æ–‡ç« </h2><div class="count">0 ç¯‡</div></div>`;
                $('#empty').hidden = false;
                $('#moreWrap').innerHTML = '';
                return;
            }

            // ç¡®å®šçœŸæ­£çš„ç²¾é€‰æ–‡ç« ï¼ˆåŸºäºfeaturedå±æ€§ï¼‰
            const trueFeaturedPost = allPosts.find(p => p.featured === true);
            // æ£€æŸ¥ç²¾é€‰æ–‡ç« æ˜¯å¦åŒ¹é…ç­›é€‰æ¡ä»¶
            const featuredMatchesFilter = trueFeaturedPost ? matchPost(trueFeaturedPost) : false;
            // æ™®é€šæ–‡ç« å°±æ˜¯ç­›é€‰ç»“æœä¸­é™¤äº†ç²¾é€‰æ–‡ç« ä¹‹å¤–çš„æ‰€æœ‰æ–‡ç« 
            const regularPosts = trueFeaturedPost ? posts.filter(p => p !== trueFeaturedPost) : posts;

            // è®¡ç®—åˆ†é¡µ
            const postsPerPage = 6;
            const totalPages = Math.ceil(regularPosts.length / postsPerPage);
            const currentPage = Math.max(1, Math.min(state.page, totalPages));
            const startIndex = (currentPage - 1) * postsPerPage;
            const endIndex = startIndex + postsPerPage;
            const currentPagePosts = regularPosts.slice(startIndex, endIndex);

            // æ¸²æŸ“å†…å®¹
            let cardsHTML = '';
            let cardIndex = 0; // ç”¨äºè·Ÿè¸ªå¡ç‰‡çš„å®é™…æ¸²æŸ“é¡ºåº

            // åªæœ‰å½“ç²¾é€‰æ–‡ç« åŒ¹é…ç­›é€‰æ¡ä»¶æ—¶æ‰æ˜¾ç¤º
            if (featuredMatchesFilter) {
                cardsHTML += renderBlogCard(trueFeaturedPost, 0); // ç²¾é€‰æ–‡ç« å§‹ç»ˆä½¿ç”¨index 0
                cardIndex = 1; // ä¸‹ä¸€ä¸ªå¡ç‰‡ä»index 1å¼€å§‹
            }

            // æ˜¾ç¤ºå½“å‰é¡µçš„æ™®é€šæ–‡ç« ï¼Œä½¿ç”¨è¿ç»­çš„indexç¡®ä¿å®ƒä»¬ä¸ä¼šè¢«å½“ä½œç²¾é€‰æ–‡ç« 
            currentPagePosts.forEach((post, index) => {
                cardsHTML += renderBlogCard(post, cardIndex + index);
            });

            root.innerHTML = `
                <div class="section">
                    <h2>æœ€æ–°æ–‡ç« </h2>
                    <div class="count">${total} ç¯‡</div>
                </div>
                <div class="grid">${cardsHTML}</div>
            `;

            $('#empty').hidden = true;

            // æ¸²æŸ“åˆ†é¡µæ§ä»¶
            renderPagination(currentPage, totalPages, regularPosts.length);

            // ç»‘å®šå¡ç‰‡äº‹ä»¶
            bindCardEvents();
        }

        function renderPagination(currentPage, totalPages, regularPostsCount) {
            const moreWrap = $('#moreWrap');

            if (totalPages <= 1) {
                moreWrap.innerHTML = '';
                return;
            }

            let paginationHTML = '<div class="pagination-wrapper">';
            paginationHTML += '<div class="pagination">';

            // ä¸Šä¸€é¡µæŒ‰é’®
            if (currentPage > 1) {
                paginationHTML += `<button class="btn ghost pagination-btn" data-page="${currentPage - 1}">ä¸Šä¸€é¡µ</button>`;
            }

            // é¡µç æŒ‰é’®
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    paginationHTML += `<button class="btn pagination-btn active" data-page="${i}">${i}</button>`;
                } else if (i === 1 || i === totalPages || Math.abs(i - currentPage) <= 1) {
                    paginationHTML += `<button class="btn ghost pagination-btn" data-page="${i}">${i}</button>`;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    paginationHTML += '<span class="pagination-ellipsis">...</span>';
                }
            }

            // ä¸‹ä¸€é¡µæŒ‰é’®
            if (currentPage < totalPages) {
                paginationHTML += `<button class="btn ghost pagination-btn" data-page="${currentPage + 1}">ä¸‹ä¸€é¡µ</button>`;
            }

            paginationHTML += '</div>';

            // æ·»åŠ é¡µé¢ä¿¡æ¯
            paginationHTML += `<div class="pagination-info">ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µ Â· ${regularPostsCount} ç¯‡æ–‡ç« </div>`;
            paginationHTML += '</div>';

            moreWrap.innerHTML = paginationHTML;

            // ç»‘å®šåˆ†é¡µæŒ‰é’®äº‹ä»¶
            $$('.pagination-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = parseInt(btn.dataset.page);
                    if (page && page !== currentPage) {
                        state.page = page;
                        renderBlogList();
                        // æ»šåŠ¨åˆ°é¡¶éƒ¨
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            });
        }

        function renderBlogCard(p, index) {
            const tags = p.tags || [];
            const maxTags = 3;
            const visibleTags = tags.slice(0, maxTags);
            const hiddenTags = tags.slice(maxTags);
            const readTime = Math.max(1, Math.ceil(stripHTML(p.content).length / 500));
            const excerpt = stripHTML(p.content).slice(0, 120) + (stripHTML(p.content).length > 120 ? 'â€¦' : '');
            // åŸºäºæ–‡ç« æ ‡é¢˜ç”Ÿæˆå›ºå®šçš„æµè§ˆæ¬¡æ•°ï¼Œé¿å…æ¯æ¬¡åˆ·æ–°éƒ½å˜åŒ–
            const viewCount = Math.floor((p.title.length * 137 + p.date.length * 73) % 1500) + 500;

            let tagsHTML = visibleTags.map(t =>
                `<a class="tag" href="#" data-tag="${escapeHTML(t)}">#${escapeHTML(t)}</a>`
            ).join('');

            if (hiddenTags.length > 0) {
                tagsHTML += `<button class="blog-tag expand-tags" data-card-index="${index}">+${hiddenTags.length}</button>`;
            }

            const date = new Date(p.date);
            const dayNum = date.getDate().toString().padStart(2, '0');
            const monthShort = date.toLocaleDateString('en-US', { month: 'short' }).toUpperCase();

            // åˆ¤æ–­æ˜¯å¦ä¸ºç²¾é€‰æ–‡ç« ï¼ˆåªåŸºäºfeaturedå±æ€§ï¼Œä¸ä¾èµ–ä½ç½®ï¼‰
            const isFeatured = p.featured === true;

            if (isFeatured) {
                // Featured æ¨ªå¡ï¼šè·¨ä¸¤åˆ—ã€å¸¦å°é¢
                return `
                    <article class="post post--featured" role="article" data-url="#/post/${encodeURIComponent(p.slug)}" data-title="${escapeHTML(p.title)}" data-index="${index}">
                        <div class="cover">
                            <div class="cover-placeholder">ç²¾é€‰</div>
                            <span class="cap">ç²¾é€‰</span>
                        </div>
                        <div class="content">
                            <h2 class="title"><a href="#/post/${encodeURIComponent(p.slug)}">${escapeHTML(p.title)}</a></h2>
                            <div class="meta">
                                <time datetime="${p.date}">${fmtDate(p.date)}</time>
                                <span>${readTime} åˆ†é’Ÿè¯»å®Œ</span>
                                <span>${viewCount.toLocaleString()} æ¬¡æµè§ˆ</span>
                            </div>
                            ${excerpt ? `<p class="excerpt">${escapeHTML(excerpt)}</p>` : ''}
                            ${tags.length > 0 ? `<div class="tags" data-all-tags='${JSON.stringify(tags)}'>${tagsHTML}</div>` : ''}
                            <div class="foot">
                                <a class="btn" href="#/post/${encodeURIComponent(p.slug)}">
                                    é˜…è¯»å…¨æ–‡
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M5 12h14M13 5l7 7-7 7" stroke-width="1.8"/></svg>
                                </a>
                            </div>
                            <a class="stretched" href="#/post/${encodeURIComponent(p.slug)}" aria-label="é˜…è¯»å…¨æ–‡ï¼š${escapeHTML(p.title)}"></a>
                        </div>
                    </article>
                `;
            } else {
                // Rail å¡ï¼šå·¦ä¾§æ—¥æœŸå¯¼è½¨ï¼Œæ›´ç´§å‡‘çš„è®¾è®¡
                return `
                    <article class="post post--rail" role="article" data-url="#/post/${encodeURIComponent(p.slug)}" data-title="${escapeHTML(p.title)}" data-index="${index}">
                        <aside class="rail">
                            ${p.pinned ? '<span class="pin">ç½®é¡¶</span>' : ''}
                            <div class="day">${dayNum}</div>
                            <div class="month">${monthShort}</div>
                        </aside>
                        <div class="content">
                            <h2 class="title"><a href="#/post/${encodeURIComponent(p.slug)}">${escapeHTML(p.title)}</a></h2>
                            ${tags.length > 0 ? `<div class="tags" data-all-tags='${JSON.stringify(tags)}'>${tagsHTML}</div>` : ''}
                            <div class="foot">
                                <a class="btn" href="#/post/${encodeURIComponent(p.slug)}">
                                    é˜…è¯»å…¨æ–‡
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M5 12h14M13 5l7 7-7 7" stroke-width="1.8"/></svg>
                                </a>
                                <span class="read-time">${readTime} åˆ†é’Ÿè¯»å®Œ</span>
                            </div>
                            <a class="stretched" href="#/post/${encodeURIComponent(p.slug)}" aria-label="é˜…è¯»å…¨æ–‡ï¼š${escapeHTML(p.title)}"></a>
                        </div>
                    </article>
                `;
            }
        }

        function renderPost(slug) {
            const p = state.data.posts.find(x => x.slug === slug);
            const root = $('#content');
            if (!p) { root.innerHTML = `<div class="empty">æœªæ‰¾åˆ°æ–‡ç« ã€‚</div>`; return; }

            const idx = sortedPosts().findIndex(x => x.slug === slug);
            const prev = sortedPosts()[idx - 1];
            const next = sortedPosts()[idx + 1];

            root.innerHTML = `
        <article class="article" role="article">
          <div class="article-hd">
            <h1>${escapeHTML(p.title)}</h1>
            <div class="meta">
              <span>${fmtDate(p.date)}</span>
              <div class="tags">${(p.tags || []).map(t => `<a class="t" href="#/tags/${encodeURIComponent(t)}">#${escapeHTML(t)}</a>`).join('')}</div>
            </div>
          </div>
          <div class="article-bd">
            <div class="article-content" id="articleContent">${p.content}</div>
            <aside class="article-aside">
              <div class="toc" id="toc"></div>
              <div style="margin-top:14px">
                <a class="btn ghost" href="#/">è¿”å›é¦–é¡µ</a>
              </div>
            </aside>
          </div>
        </article>
        <div style="display:flex;justify-content:space-between;margin-top:12px;gap:8px;flex-wrap:wrap">
          <div>${prev ? `<a class="btn ghost" href="#/post/${encodeURIComponent(prev.slug)}">â† ä¸Šä¸€ç¯‡</a>` : ''}</div>
          <div>${next ? `<a class="btn ghost" href="#/post/${encodeURIComponent(next.slug)}">ä¸‹ä¸€ç¯‡ â†’</a>` : ''}</div>
        </div>
      `;

            buildTOC();
            enhanceCodeBlocks();
            updateProgress();
            window.addEventListener('scroll', updateProgress, { passive: true });
        }

        function buildTOC() {
            const article = $('#articleContent');
            const toc = $('#toc');
            const hs = $$('h2, h3', article);
            if (!hs.length) { toc.innerHTML = ''; return; }

            toc.innerHTML = `<h4>ç›®å½•</h4>` + hs.map(h => {
                if (!h.id) h.id = slugify(h.textContent);
                const isH3 = h.tagName.toLowerCase() === 'h3';
                const indent = isH3 ? ' style="padding-left: 20px; font-size: 12px;"' : '';
                return `<a href="javascript:void(0)" data-id="${h.id}" class="toc-link"${indent}>${escapeHTML(h.textContent)}</a>`;
            }).join('');

            // ç»‘å®šç›®å½•ç‚¹å‡»äº‹ä»¶
            const links = $$('.toc-link', toc);
            links.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.dataset.id;
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        // å¹³æ»‘æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start',
                            inline: 'nearest'
                        });

                        // æ›´æ–° URL hashï¼Œä½†ä¸è§¦å‘è·¯ç”±å˜åŒ–
                        const currentUrl = new URL(window.location);
                        currentUrl.hash = currentUrl.hash.split('#')[0] + '#' + targetId;
                        window.history.replaceState(null, '', currentUrl);
                    }
                });
            });

            // ç›‘å¬æ»šåŠ¨ï¼Œé«˜äº®å½“å‰ç« èŠ‚
            const io = new IntersectionObserver(entries => {
                const visibleEntries = entries.filter(e => e.isIntersecting);
                if (visibleEntries.length > 0) {
                    // å–ç¬¬ä¸€ä¸ªå¯è§çš„æ ‡é¢˜
                    const firstVisible = visibleEntries[0];
                    const id = firstVisible.target.id;
                    links.forEach(a => {
                        a.setAttribute('aria-current', a.dataset.id === id ? 'true' : 'false');
                    });
                }
            }, {
                rootMargin: '-20% 0px -70% 0px',
                threshold: [0, 0.1, 0.5, 1]
            });

            hs.forEach(h => io.observe(h));
        }

        function enhanceCodeBlocks() {
            $$('#articleContent pre').forEach(pre => {
                if (pre.querySelector('button.copy')) return;
                const btn = document.createElement('button');
                btn.textContent = 'å¤åˆ¶ä»£ç ';
                btn.className = 'btn ghost copy';
                btn.style.cssText = 'position:absolute; right:10px; margin-top:6px';
                const wrap = document.createElement('div');
                wrap.style.position = 'relative';
                pre.parentNode.insertBefore(wrap, pre);
                wrap.appendChild(btn); wrap.appendChild(pre);
                btn.onclick = () => {
                    navigator.clipboard.writeText(pre.innerText).then(() => {
                        btn.textContent = 'å·²å¤åˆ¶'; setTimeout(() => btn.textContent = 'å¤åˆ¶ä»£ç ', 1200);
                    });
                };
            });
        }

        function updateProgress() {
            const art = $('#articleContent');
            const bar = $('#progress');
            if (!art || !bar) return;
            const rect = art.getBoundingClientRect();
            const total = art.scrollHeight - window.innerHeight;
            const scrolled = Math.min(Math.max(window.scrollY - art.offsetTop, 0), total);
            const p = total > 0 ? scrolled / total : 0;
            bar.style.setProperty('--p', p);
        }

        function renderArchive() {
            const root = $('#content');
            const posts = sortedPosts();
            const byYear = new Map();
            const byMonth = new Map();

            // æŒ‰å¹´ä»½å’Œæœˆä»½åˆ†ç»„
            posts.forEach(p => {
                const date = new Date(p.date);
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const yearMonth = `${year}-${month.toString().padStart(2, '0')}`;

                if (!byYear.has(year)) byYear.set(year, []);
                byYear.get(year).push(p);

                if (!byMonth.has(yearMonth)) byMonth.set(yearMonth, []);
                byMonth.get(yearMonth).push(p);
            });

            // ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯
            const totalPosts = posts.length;
            const yearCount = byYear.size;
            const monthCount = byMonth.size;

            // ç”Ÿæˆå¹´ä»½è¡¨æ ¼ - Ledger é£æ ¼
            const timelineHTML = [...byYear.entries()].sort((a, b) => b[0] - a[0]).map(([year, yearPosts]) => {
                const monthsInYear = new Map();
                yearPosts.forEach(p => {
                    const month = new Date(p.date).getMonth() + 1;
                    if (!monthsInYear.has(month)) monthsInYear.set(month, []);
                    monthsInYear.get(month).push(p);
                });

                // ç”Ÿæˆè¡¨æ ¼è¡Œ
                const rowsHTML = yearPosts.map(p => {
                    const date = new Date(p.date);
                    const day = date.getDate();
                    const tagsHTML = (p.tags && p.tags.length > 0)
                        ? p.tags.slice(0, 3).map(t => `<a class="archive-tag-ghost" href="#/tag/${encodeURIComponent(t)}">#${escapeHTML(t)}</a>`).join('')
                        : '';

                    return `
                        <div class="archive-row" role="row">
                            <div class="archive-col-day" role="cell">${day}</div>
                            <div class="archive-col-title" role="cell">
                                <a href="#/post/${encodeURIComponent(p.slug)}">${escapeHTML(p.title)}</a>
                                ${p.pinned ? '<span class="small">ï¼ˆç½®é¡¶ï¼‰</span>' : ''}
                            </div>
                            <div class="archive-col-tags" role="cell">
                                ${tagsHTML}
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="archive-year">
                        <div class="archive-year-header" role="group" aria-label="å¹´ä»½ ${year}">
                            <span class="archive-year-dot" aria-hidden="true"></span>
                            <h3>${year}</h3>
                            <div class="archive-year-stats">
                                <span class="archive-badge">${yearPosts.length} ç¯‡</span>
                                <span class="archive-badge">${monthsInYear.size} ä¸ªæœˆ</span>
                            </div>
                        </div>
                        <div class="archive-table" role="table" aria-label="${year} å¹´æ–‡ç« åˆ—è¡¨">
                            ${rowsHTML}
                        </div>
                    </div>
                `;
            }).join('');

            root.innerHTML = `
                <div class="archive-header">
                    <div class="archive-title">
                        <h2>æ–‡ç« å½’æ¡£</h2>
                        <div class="archive-summary">
                            <span>å…± ${totalPosts} ç¯‡æ–‡ç« </span>
                            <span>Â·</span>
                            <span>${yearCount} å¹´</span>
                            <span>Â·</span>
                            <span>${monthCount} ä¸ªæœˆ</span>
                        </div>
                    </div>
                </div>
                <div class="archive-timeline">
                    ${timelineHTML}
                </div>
            `;
        }

        function renderTagPage(tag) {
            state.tags = new Set([tag]);
            renderTagsBar();
            renderBlogList();
        }

        // ===== ç”¨æˆ·ä½“éªŒå¢å¼º =====

        // é”®ç›˜å¯¼èˆª
        function bindCardEvents() {
            const cards = $$('.card[tabindex]');
            cards.forEach((card, index) => {
                // ç‚¹å‡»äº‹ä»¶
                card.addEventListener('click', (e) => {
                    if (e.target.closest('.open, .btn, .t, a')) return;
                    const url = card.dataset.url;
                    if (url) {
                        if (url.startsWith('#')) {
                            location.hash = url;
                        } else {
                            window.open(url, '_blank', 'noopener');
                        }
                    }
                });

                // é”®ç›˜äº‹ä»¶
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        card.click();
                    } else if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                        e.preventDefault();
                        const next = cards[index + 1];
                        if (next) next.focus();
                    } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                        e.preventDefault();
                        const prev = cards[index - 1];
                        if (prev) prev.focus();
                    }
                });

                // å³é”®èœå•ï¼ˆä»…å¯¼èˆªæ¨¡å¼ï¼‰
                if (state.section === 'nav') {
                    card.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        state.currentCard = card;
                        showContextMenu(e.clientX, e.clientY);
                    });
                }
            });

            // ç»‘å®šæ‰“å¼€æŒ‰é’®äº‹ä»¶
            $$('.open').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const url = btn.getAttribute('data-url');
                    window.open(url, '_blank', 'noopener');
                    e.stopPropagation();
                });
            });

            // ç»‘å®šåšå®¢å¡ç‰‡å†…æ ‡ç­¾ç­›é€‰äº‹ä»¶
            $$('.tag-filter, .tag').forEach(tagBtn => {
                tagBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const tag = tagBtn.dataset.tag;

                    // åˆ‡æ¢æ ‡ç­¾ç­›é€‰çŠ¶æ€
                    if (state.tags.has(tag)) {
                        state.tags.delete(tag);
                    } else {
                        state.tags.add(tag);
                    }

                    // é‡æ–°æ¸²æŸ“
                    renderTagsBar();
                    renderContent();
                    renderSidebar();
                });
            });

            // ç»‘å®š"é˜…è¯»å…¨æ–‡"æŒ‰é’®äº‹ä»¶
            $$('.blog-read-more').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const url = btn.dataset.url;
                    if (url) {
                        location.hash = url;
                    }
                });
            });

            // ç»‘å®šæ ‡ç­¾å±•å¼€æŒ‰é’®äº‹ä»¶
            $$('.expand-tags').forEach(expandBtn => {
                expandBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();

                    const tagsContainer = expandBtn.parentElement;
                    const allTags = JSON.parse(tagsContainer.dataset.allTags);

                    // é‡æ–°æ¸²æŸ“æ‰€æœ‰æ ‡ç­¾
                    const allTagsHTML = allTags.map(t =>
                        `<button class="t tag-filter ${state.tags.has(t) ? 'active' : ''}" data-tag="${escapeHTML(t)}">#${escapeHTML(t)}</button>`
                    ).join('') + `<button class="t collapse-tags">æ”¶èµ·</button>`;

                    tagsContainer.innerHTML = allTagsHTML;

                    // é‡æ–°ç»‘å®šæ–°ç”Ÿæˆçš„æ ‡ç­¾æŒ‰é’®äº‹ä»¶
                    tagsContainer.querySelectorAll('.tag-filter').forEach(tagBtn => {
                        tagBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            const tag = tagBtn.dataset.tag;

                            if (state.tags.has(tag)) {
                                state.tags.delete(tag);
                            } else {
                                state.tags.add(tag);
                            }

                            renderTagsBar();
                            renderContent();
                            renderSidebar();
                        });
                    });

                    // ç»‘å®šæ”¶èµ·æŒ‰é’®äº‹ä»¶
                    const collapseBtn = tagsContainer.querySelector('.collapse-tags');
                    if (collapseBtn) {
                        collapseBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();

                            // é‡æ–°æ¸²æŸ“ä¸ºæŠ˜å çŠ¶æ€
                            renderContent();
                        });
                    }
                });
            });
        }

        // å³é”®èœå•
        function showContextMenu(x, y) {
            const menu = $('#contextMenu');
            menu.style.display = 'block';
            menu.style.left = `${x}px`;
            menu.style.top = `${y}px`;

            // ç¡®ä¿èœå•ä¸è¶…å‡ºè§†çª—
            const rect = menu.getBoundingClientRect();
            if (rect.right > window.innerWidth) {
                menu.style.left = `${x - rect.width}px`;
            }
            if (rect.bottom > window.innerHeight) {
                menu.style.top = `${y - rect.height}px`;
            }
        }

        function hideContextMenu() {
            $('#contextMenu').style.display = 'none';
            state.currentCard = null;
        }

        // å³é”®èœå•äº‹ä»¶
        $$('.context-menu-item').forEach(item => {
            item.addEventListener('click', () => {
                const action = item.dataset.action;
                const card = state.currentCard;
                if (!card) return;

                const url = card.dataset.url;
                const title = card.dataset.title;

                switch (action) {
                    case 'copy':
                        navigator.clipboard.writeText(url).then(() => {
                            // å¯ä»¥æ·»åŠ æç¤º
                            console.log('é“¾æ¥å·²å¤åˆ¶');
                        });
                        break;
                    case 'open':
                        window.open(url, '_blank', 'noopener');
                        break;
                    case 'edit':
                        // è¿™é‡Œå¯ä»¥æ·»åŠ ç¼–è¾‘åŠŸèƒ½
                        console.log('ç¼–è¾‘åŠŸèƒ½å¾…å®ç°');
                        break;
                    case 'delete':
                        // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ é™¤åŠŸèƒ½
                        console.log('åˆ é™¤åŠŸèƒ½å¾…å®ç°');
                        break;
                }
                hideContextMenu();
            });
        });

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—å³é”®èœå•
        document.addEventListener('click', hideContextMenu);
        document.addEventListener('contextmenu', (e) => {
            if (!e.target.closest('.card')) {
                hideContextMenu();
            }
        });

        // ===== ä¸»æ¸²æŸ“å‡½æ•° =====
        function renderContent() {
            renderTagsBar();
            $('#moreWrap').innerHTML = '';
            state.focusedCardIndex = -1;

            if (state.section === 'nav') {
                renderNavigation();
            } else {
                // æ£€æŸ¥æ˜¯å¦æ˜¯ç‰¹æ®Šè·¯ç”±
                const hash = location.hash || '#/';
                const seg = hash.slice(2).split('/');
                const page = seg[0];

                if (page === 'post') {
                    renderPost(decodeURIComponent(seg[1] || ''));
                } else if (page === 'archive') {
                    renderArchive();
                } else if (page === 'tags') {
                    const t = decodeURIComponent(seg[1] || '');
                    if (t) renderTagPage(t); else { state.tags.clear(); renderBlogList(); }
                } else {
                    state.page = 1;
                    renderBlogList();
                }
            }
        }

        // ===== ç•Œé¢åˆ‡æ¢ =====
        function switchSection(section, keepState = false) {
            state.section = section;

            // å¦‚æœä¸ä¿æŒçŠ¶æ€ï¼Œåˆ™é‡ç½®æœç´¢å’Œç­›é€‰
            if (!keepState) {
                state.q = '';
                state.tags.clear();
                state.page = 1;
                $('#q').value = '';
            }

            // æ›´æ–°å¯¼èˆªæ ‡ç­¾çŠ¶æ€
            $$('.nav-tab').forEach(tab => {
                tab.setAttribute('aria-pressed', String(tab.dataset.section === section));
            });

            // æ˜¾ç¤º/éšè—å¯¹åº”æ§ä»¶
            $('#navControls').style.display = section === 'nav' ? 'block' : 'none';
            $('#blogControls').style.display = section === 'blog' ? 'block' : 'none';

            // æ›´æ–°æœç´¢æ¡†æç¤º
            $('#q').placeholder = section === 'nav' ? 'æœç´¢ç½‘ç«™ã€æè¿°æˆ–æ ‡ç­¾ï¼ˆæŒ‰ / èšç„¦ï¼‰' : 'æœç´¢æ ‡é¢˜ã€æ­£æ–‡æˆ–æ ‡ç­¾ï¼ˆæŒ‰ / èšç„¦ï¼‰';

            // æ›´æ–°RSSæŒ‰é’®æ˜¾ç¤º
            $('#exportRssBtn').style.display = section === 'blog' ? 'inline-flex' : 'none';

            renderContent();
            renderSidebar();
        }

        // ===== äº‹ä»¶ç»‘å®š =====
        const qInput = $('#q');
        const clearSearchBtn = $('#clearSearchBtn');

        // æ›´æ–°æ¸…é™¤æŒ‰é’®çš„æ˜¾ç¤ºçŠ¶æ€
        function updateClearButton() {
            if (qInput.value.trim()) {
                clearSearchBtn.classList.add('show');
            } else {
                clearSearchBtn.classList.remove('show');
            }
        }

        qInput.addEventListener('input', debounce(() => {
            state.q = qInput.value;
            state.page = 1;
            updateClearButton();
            renderContent();
        }, 120));

        // æ¸…é™¤æœç´¢æŒ‰é’®äº‹ä»¶
        clearSearchBtn.addEventListener('click', () => {
            qInput.value = '';
            state.q = '';
            state.page = 1;
            updateClearButton();
            renderContent();
            qInput.focus();
        });

        // åˆå§‹åŒ–æ¸…é™¤æŒ‰é’®çŠ¶æ€
        updateClearButton();

        document.addEventListener('keydown', (e) => {
            // æ£€æŸ¥æ˜¯å¦åœ¨è¾“å…¥æ¡†ä¸­æˆ–å¯¹è¯æ¡†ä¸­
            const isInInput = document.activeElement.tagName === 'INPUT' ||
                document.activeElement.tagName === 'TEXTAREA' ||
                document.activeElement.contentEditable === 'true';
            const isInDialog = document.activeElement.closest('dialog');

            // å¦‚æœåœ¨è¾“å…¥æ¡†æˆ–å¯¹è¯æ¡†ä¸­ï¼Œåªå¤„ç† Escape é”®
            if (isInInput || isInDialog) {
                if (e.key === 'Escape') {
                    hideContextMenu();

                    // å¦‚æœåœ¨å¯¹è¯æ¡†ä¸­ï¼Œå…³é—­å¯¹è¯æ¡†
                    if (isInDialog) {
                        const dialog = document.activeElement.closest('dialog');
                        if (dialog) {
                            closeDialog(dialog);
                        }
                    }

                    // å¦‚æœåœ¨æœç´¢æ¡†ä¸­æŒ‰ Escapeï¼Œå…ˆæ¸…é™¤å†…å®¹ï¼Œå†å¤±å»ç„¦ç‚¹
                    if (document.activeElement === qInput) {
                        if (qInput.value.trim()) {
                            // å¦‚æœæœ‰æœç´¢å†…å®¹ï¼Œå…ˆæ¸…é™¤
                            qInput.value = '';
                            state.q = '';
                            state.page = 1;
                            updateClearButton();
                            renderContent();
                        } else {
                            // å¦‚æœæ²¡æœ‰æœç´¢å†…å®¹ï¼Œå¤±å»ç„¦ç‚¹
                            qInput.blur();
                        }
                    }
                }
                return;
            }

            // å…¨å±€å¿«æ·é”®
            if (e.key === '/' && document.activeElement !== qInput) {
                e.preventDefault();
                qInput.focus();
            }
            if (e.key.toLowerCase() === 't' && !e.ctrlKey && !e.metaKey) {
                e.preventDefault();
                toggleTheme();
            }
            if (e.key.toLowerCase() === 'i' && !e.ctrlKey && !e.metaKey) {
                e.preventDefault();
                openIo();
            }
            if (e.key === '?' || (e.shiftKey && e.key.toLowerCase() === '/')) {
                e.preventDefault();
                openHelp();
            }
            if (e.key === 'Escape') {
                hideContextMenu();
            }
        });

        // ä¸»å¯¼èˆªåˆ‡æ¢
        $$('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const section = tab.dataset.section;
                switchSection(section);
                // ä¿å­˜å½“å‰æ¨¡å¼çŠ¶æ€
                localStorage.setItem('current.section', section);
                // é‡ç½®è·¯ç”±åˆ°é¦–é¡µ
                if (section === 'blog') {
                    location.hash = '#/';
                }
            });
        });

        // å¯¼èˆªè§†å›¾åˆ‡æ¢
        $$('.tab').forEach(b => {
            b.addEventListener('click', () => {
                state.view = b.dataset.view;
                $$('.tab').forEach(x => x.setAttribute('aria-pressed', String(x === b)));
                renderContent();
            });
        });

        // åšå®¢é¡µé¢æŒ‰é’®
        $('#homeBtn').onclick = () => location.hash = '#/';
        $('#archiveBtn').onclick = () => location.hash = '#/archive';
        $('#tagsBtn').onclick = () => location.hash = '#/tags';

        // ä¸»é¢˜æŒ‰é’®
        $('#themeBtn').addEventListener('click', toggleTheme);

        // ä¸»é¢˜è‰²é€‰æ‹©
        const accentDialog = $('#accentDialog');
        $('#accentBtn').addEventListener('click', () => openDialog(accentDialog));
        $('#closeAccent').addEventListener('click', () => closeDialog(accentDialog));
        $$('#accentDialog .btn[data-accent]').forEach(btn => {
            btn.addEventListener('click', () => {
                const color = btn.dataset.accent;
                document.documentElement.style.setProperty('--accent', color);
                localStorage.setItem(ACCENT_KEY, color);
            });
        });

        // å¯¼å…¥/å¯¼å‡º
        const ioDialog = $('#ioDialog');
        const jsonArea = $('#jsonArea');
        const ioHint = $('#ioHint');

        function openIo() {
            jsonArea.value = JSON.stringify(state.data, null, 2);
            ioHint.innerHTML = state.section === 'nav'
                ? 'å¯¼èˆªç»“æ„ï¼š<code>{ collections: [ { name, links: [ {title,url,desc,tags:["AI"]} ] } ], posts: [...] }</code>'
                : 'åšå®¢ç»“æ„ï¼š<code>{ posts: [ { id, title, slug, date, tags:["AI"], content:"&lt;p&gt;HTML...&lt;/p&gt;" } ], collections: [...] }</code>';
            openDialog(ioDialog);
        }

        $('#ioBtn').addEventListener('click', openIo);
        $('#closeIo').addEventListener('click', () => closeDialog(ioDialog));
        $('#saveJsonBtn').addEventListener('click', () => {
            try {
                const obj = JSON.parse(jsonArea.value);
                if (!obj) throw new Error('æ— æ•ˆçš„ JSON æ•°æ®');
                if (!obj.collections) obj.collections = [];
                if (!obj.posts) obj.posts = [];
                state.data = obj;
                saveData();
                renderContent();
                renderSidebar();
                closeDialog(ioDialog);
            } catch (e) { alert('JSON æ— æ•ˆï¼š' + e.message); }
        });

        $('#downloadBtn').addEventListener('click', () => {
            const blob = new Blob([JSON.stringify(state.data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'personal-site-data.json'; a.click();
            URL.revokeObjectURL(url);
        });

        $('#exportRssBtn').addEventListener('click', () => {
            const xml = genRSS(state.data.posts);
            const blob = new Blob([xml], { type: 'application/rss+xml' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'feed.xml'; a.click();
            URL.revokeObjectURL(a.href);
        });

        // å¸®åŠ©
        const helpDialog = $('#helpDialog');
        function openHelp() { openDialog(helpDialog); }
        $('#helpBtn').addEventListener('click', openHelp);
        $('#closeHelp').addEventListener('click', () => closeDialog(helpDialog));

        // å¯¹è¯æ¡†é€šç”¨æ‰“å¼€ï¼ˆSafari é™çº§ï¼‰
        function openDialog(dlg) {
            if (typeof dlg.showModal === 'function') {
                dlg.showModal();
            } else {
                dlg.setAttribute('open', '');
            }

            // æ·»åŠ ç‚¹å‡»ç©ºç™½åŒºåŸŸå…³é—­åŠŸèƒ½
            const closeOnBackdrop = (e) => {
                if (e.target === dlg) {
                    closeDialog(dlg);
                }
            };

            // æ¸…ç†ä¹‹å‰çš„ç›‘å¬å™¨ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            if (dlg._backdropListener) {
                dlg.removeEventListener('click', dlg._backdropListener);
            }

            // ä¿å­˜ç›‘å¬å™¨å¼•ç”¨ä»¥ä¾¿åç»­æ¸…ç†
            dlg._backdropListener = closeOnBackdrop;
            dlg.addEventListener('click', closeOnBackdrop);
        }

        // å¯¹è¯æ¡†é€šç”¨å…³é—­
        function closeDialog(dlg) {
            if (typeof dlg.close === 'function') {
                dlg.close();
            } else {
                dlg.removeAttribute('open');
            }

            // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
            if (dlg._backdropListener) {
                dlg.removeEventListener('click', dlg._backdropListener);
                dlg._backdropListener = null;
            }
        }

        // ===== RSS ç”Ÿæˆ =====
        function genRSS(posts) {
            const site = location.origin + location.pathname.replace(/index\.html?$/i, '');
            const items = posts
                .slice().sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(p => {
                    const link = site + '#/post/' + encodeURIComponent(p.slug);
                    const desc = escapeHTML(stripHTML(p.content).slice(0, 180));
                    return `\n<item>\n  <title>${escapeHTML(p.title)}</title>\n  <link>${link}</link>\n  <guid>${link}</guid>\n  <pubDate>${new Date(p.date).toUTCString()}</pubDate>\n  <description>${desc}</description>\n</item>`;
                }).join('');
            return `<?xml version="1.0" encoding="UTF-8"?>\n<rss version="2.0">\n<channel>\n  <title>ä¼˜é›…Â·ç®€çº¦ä¸ªäººç«™</title>\n  <link>${site}</link>\n  <description>ä¸ªäººå¯¼èˆªä¸åšå®¢</description>${items}\n</channel>\n</rss>`;
        }

        // ===== è·¯ç”±å¤„ç† =====
        window.addEventListener('hashchange', () => {
            if (state.section === 'blog') {
                const hash = location.hash || '#/';
                // å¦‚æœæ˜¯æ–‡ç« å†…çš„é”šç‚¹é“¾æ¥ï¼Œä¸é‡æ–°æ¸²æŸ“å†…å®¹
                if (hash.includes('#/post/') && hash.split('#').length > 2) {
                    // è¿™æ˜¯æ–‡ç« å†…çš„é”šç‚¹ï¼Œä¸éœ€è¦é‡æ–°æ¸²æŸ“
                    return;
                }
                renderContent();
            }
        });

        // ===== åˆå§‹åŒ– =====
        function initializeApp() {
            const hash = location.hash || '#/';
            const seg = hash.slice(2).split('/');
            const page = seg[0];

            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„æ¨¡å¼çŠ¶æ€
            const savedSection = localStorage.getItem('current.section');

            // æ ¹æ® URL åˆ¤æ–­åº”è¯¥æ˜¾ç¤ºå“ªä¸ªæ¨¡å¼
            if (page === 'post' || page === 'archive' || page === 'tags') {
                // å¦‚æœæ˜¯æ˜ç¡®çš„åšå®¢è·¯ç”±ï¼Œåˆ‡æ¢åˆ°åšå®¢æ¨¡å¼
                switchSection('blog', true);
                localStorage.setItem('current.section', 'blog');
            } else if (page === '' || page === undefined) {
                // å¦‚æœæ˜¯æ ¹è·¯å¾„ï¼Œæ£€æŸ¥ä¸Šæ¬¡çš„æ¨¡å¼
                if (savedSection === 'blog') {
                    // å¦‚æœä¸Šæ¬¡åœ¨åšå®¢æ¨¡å¼ï¼Œä¿æŒåšå®¢æ¨¡å¼
                    switchSection('blog', true);
                } else {
                    // é»˜è®¤æ˜¾ç¤ºå¯¼èˆªæ¨¡å¼
                    switchSection('nav');
                    localStorage.setItem('current.section', 'nav');
                }
            } else {
                // å…¶ä»–æƒ…å†µé»˜è®¤æ˜¾ç¤ºå¯¼èˆªæ¨¡å¼
                switchSection('nav');
                localStorage.setItem('current.section', 'nav');
            }
        }

        initializeApp();
    </script>
</body>

</html>